<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <base href="./" />
  <title>Email Engagement Report — CTCT for Teams</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.js"></script>
  <script src="components/left-nav.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            main: { 50: '#f6fcff', 100: '#e6f8ff', 200: '#d6eafe', 300: '#a6d3fd', 400: '#65abff', 500: '#468af1', 600: '#186ded', 700: '#085fe2', 800: '#1357be', 900: '#0046ae', 950: '#0b3c85' },
            neutral: { 50: '#fcfcfd', 100: '#f7f9fd', 200: '#f0f4fa', 300: '#dce2ec', 400: '#c9d0de', 500: '#8d9bb6', 600: '#6b7492', 700: '#63708a', 800: '#5d687e', 900: '#3f4b63', 950: '#313b4d' },
            success: { 50: '#f6fef9', 100: '#ecfdf3', 200: '#dbfae6', 300: '#a9efc5', 400: '#75e0a7', 500: '#47cd89', 600: '#17b26a', 700: '#079455', 800: '#067647', 900: '#085d3a', 950: '#074d31' },
            danger: { 50: '#fffafa', 100: '#fef3f2', 200: '#fee4e2', 300: '#fecdca', 400: '#fda29b', 500: '#fe5a58', 600: '#f04438', 700: '#d92d20', 800: '#b42318', 900: '#912018', 950: '#7a271a' },
            warning: { 50: '#fffcf5', 100: '#fff8eb', 200: '#fff2de', 300: '#ffdaaf', 400: '#ffca8d', 500: '#ffb26b', 600: '#f79009', 700: '#e97420', 800: '#d55b03', 900: '#93370d', 950: '#792e0d' },
            accent: { 50: '#fbfaff', 100: '#f5f3ff', 200: '#ece9fe', 300: '#ddd6fe', 400: '#c3b5fd', 500: '#a48afb', 600: '#875bf7', 700: '#7839ee', 800: '#6927da', 900: '#5720b7', 950: '#401687' },
            ctct: { blue: '#468af1', 'blue-light': '#e6f8ff', orange: '#f79009' }
          },
          fontFamily: { sans: ['CTSans', 'system-ui', 'sans-serif'] }
        }
      }
    };
  </script>
  <style>
    @font-face { font-family: 'CTSans'; src: url('fonts/CTSans-Regular.woff2') format('woff2'); font-weight: 400; font-style: normal; font-display: swap; }
    @font-face { font-family: 'CTSans'; src: url('fonts/CTSans-Semibold.woff2') format('woff2'); font-weight: 600; font-style: normal; font-display: swap; }
    @font-face { font-family: 'CTSans'; src: url('fonts/CTSans-Bold.woff2') format('woff2'); font-weight: 700; font-style: normal; font-display: swap; }
    body { line-height: 1.5; background: #ffffff; }
    .main-content-wrap { margin-left: -1rem; margin-right: -1rem; }
    .main-content-inner { padding: 0 2rem; }
    .sticky-header { position: sticky; top: 0; z-index: 40; margin-left: 0; margin-right: 0; padding: 0 0 28px; border-bottom: 1px solid transparent; background: transparent; box-shadow: none; transition: background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, padding 0.2s ease; }
    .sticky-header.is-stuck { background: rgba(250,251,252,0.95); backdrop-filter: blur(8px); border-bottom: 3px solid #65abff; /* main-400 */ box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.05); margin-left: -2rem; margin-right: -2rem; padding: 1.25rem 0 1.25rem; padding-left: 2rem; padding-right: 2rem; }
    .sticky-header .view-insights-sticky-only { visibility: hidden; opacity: 0; pointer-events: none; transition: visibility 0.2s ease, opacity 0.2s ease; }
    .sticky-header.is-stuck.your-insights-visible .view-insights-sticky-only { visibility: visible; opacity: 1; pointer-events: auto; }
    body.sticky-header-stuck #ai-insights-trigger { display: none !important; }
    @media (min-width: 640px) {
      .sticky-header.is-stuck { margin-left: -2.5rem; margin-right: -2.5rem; padding-left: 2.5rem; padding-right: 2.5rem; }
    }
    @media (min-width: 1024px) {
      .sticky-header.is-stuck { margin-left: -3rem; margin-right: -3rem; padding-left: 3rem; padding-right: 3rem; }
    }
    .funnel-card { border-radius: 1rem; border: 1px solid rgb(245 245 245); box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); }
    .funnel-card .insight-card-icon-bg { background-color: #F7F9FD; }
    .insights-tag { border: 1px solid rgba(255,255,255,0.2); border-radius: 0.375rem; }
    .insights-tag.active { border: 2px solid transparent; border-radius: 0.375rem; background: linear-gradient(#313b4d, #313b4d) padding-box, linear-gradient(90deg, #875bf7, #c026d3) border-box; background-origin: padding-box; background-clip: padding-box, border-box; }
    .funnel-card-header { background: linear-gradient(180deg, #fafbfc 0%, #fff 100%); }
    /* Funnel: modern viz on top, label bars below — animate when scrolled into view */
    .funnel-wrapper { display: flex; flex-direction: column; gap: 0; width: 100%; border-radius: 0 0 16px 16px; overflow: hidden; }
    .funnel-viz { clip-path: polygon(0 0, 100% 45%, 100% 100%, 0 100%); border-radius: 16px 16px 0 0; display: grid; grid-template-columns: 7fr 6fr 6fr 5fr 4fr; gap: 0; width: 100%; }
    .funnel-viz .funnel-segment { min-height: 160px; min-width: 0; position: relative; opacity: 0; transform: scaleX(0); transform-origin: left; }
    .funnel-wrapper.funnel-in-view .funnel-viz .funnel-segment { animation: funnelSegmentIn 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
    .funnel-viz .funnel-segment::after { content: ''; position: absolute; inset: 0; border-radius: inherit; pointer-events: none; background: linear-gradient(180deg, rgba(255,255,255,0.12) 0%, transparent 40%); }
    .funnel-viz .funnel-segment:nth-child(1) { animation-delay: 0.05s; }
    .funnel-viz .funnel-segment:nth-child(2) { animation-delay: 0.1s; }
    .funnel-viz .funnel-segment:nth-child(3) { animation-delay: 0.15s; }
    .funnel-viz .funnel-segment:nth-child(4) { animation-delay: 0.2s; }
    .funnel-viz .funnel-segment:nth-child(5) { animation-delay: 0.25s; }
    .funnel-viz .funnel-segment + .funnel-segment { margin-left: -1px; }
    .funnel-viz .funnel-segment { cursor: pointer; transition: filter 0.2s ease; }
    .funnel-viz .funnel-segment:hover,
    .funnel-viz .funnel-segment.funnel-stage-hover { filter: brightness(1.12); }
    .funnel-label-bar { cursor: pointer; transition: filter 0.2s ease; }
    .funnel-label-bar:hover,
    .funnel-label-bar.funnel-stage-hover { filter: brightness(1.15); }
    @keyframes funnelSegmentIn { from { opacity: 0; transform: scaleX(0); } to { opacity: 1; transform: scaleX(1); } }
    .funnel-labels { display: grid; grid-template-columns: 7fr 6fr 6fr 5fr 4fr; gap: 0; width: 100%; }
    .funnel-label-bar + .funnel-label-bar { margin-left: -1px; }
    .funnel-label-bar { padding: 1rem 1.25rem; color: #fff; border-radius: 0; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem; font-size: 0.875rem; letter-spacing: 0.01em; opacity: 0; transform: translateY(8px); }
    .funnel-wrapper.funnel-in-view .funnel-label-bar { animation: funnelLabelIn 0.45s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
    .funnel-label-bar:nth-child(1) { animation-delay: 0.2s; }
    .funnel-label-bar:nth-child(2) { animation-delay: 0.25s; }
    .funnel-label-bar:nth-child(3) { animation-delay: 0.3s; }
    .funnel-label-bar:nth-child(4) { animation-delay: 0.35s; }
    .funnel-label-bar:nth-child(5) { animation-delay: 0.4s; }
    .funnel-label-left { font-weight: 500; opacity: 0.98; display: inline-flex; align-items: center; gap: 0.5rem; }
    .funnel-label-left .funnel-strip-icon { flex-shrink: 0; opacity: 0.9; }
    .funnel-stage-value { font-size: 1.0625rem; font-weight: 700; letter-spacing: -0.02em; }
    @keyframes funnelLabelIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    /* Modern funnel palette: indigo/violet progression + coral for bounce */
    .funnel-segment-1 { background: linear-gradient(165deg, #a5b4fc 0%, #818cf8 35%, #6366f1 100%); }
    .funnel-label-bar.funnel-segment-1 { background: linear-gradient(180deg, #6366f1 0%, #4f46e5 100%); }
    .funnel-segment-2 { background: linear-gradient(165deg, #818cf8 0%, #6366f1 35%, #4f46e5 100%); }
    .funnel-label-bar.funnel-segment-2 { background: linear-gradient(180deg, #4f46e5 0%, #4338ca 100%); }
    .funnel-segment-3 { background: linear-gradient(165deg, #6366f1 0%, #4f46e5 35%, #4338ca 100%); }
    .funnel-label-bar.funnel-segment-3 { background: linear-gradient(180deg, #4338ca 0%, #3730a3 100%); }
    .funnel-segment-4 { background: linear-gradient(165deg, #4f46e5 0%, #4338ca 35%, #3730a3 100%); }
    .funnel-label-bar.funnel-segment-4 { background: linear-gradient(180deg, #3730a3 0%, #312e81 100%); }
    .funnel-segment-5 { background: linear-gradient(165deg, #fda4af 0%, #fb7185 35%, #f43f5e 100%); }
    .funnel-label-bar.funnel-segment-5 { background: linear-gradient(180deg, #f43f5e 0%, #e11d48 100%); }
    .funnel-stage-delta { border-radius: 6px; padding: 0.3rem 0.6rem; font-size: 0.75rem; font-weight: 600; letter-spacing: 0.02em; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06); }
    .funnel-stage-delta.positive { background: rgba(255,255,255,0.95); color: #166534; }
    .funnel-stage-delta.negative { background: rgba(255,255,255,0.9); color: #b91c1c; }
    .trend-arrow { display: inline-block; font-size: 1.35em; font-weight: 800; margin-left: 0.2rem; vertical-align: middle; line-height: 1; }
    @media (max-width: 1799px) {
      .funnel-label-bar { flex-direction: column; align-items: flex-start; }
      .funnel-label-right { width: 100%; display: flex; align-items: center; justify-content: space-between; }
    }
    @media (max-width: 639px) {
      .funnel-viz { display: none !important; }
      .funnel-wrapper { grid-template-columns: 1fr; gap: 6px; border-radius: 12px; }
      .funnel-labels { display: flex; flex-direction: column; gap: 6px; grid-template-columns: unset; }
      .funnel-label-bar { border-left: none !important; border-radius: 10px; }
      .funnel-label-bar:nth-child(1) { width: 100%; }
      .funnel-label-bar:nth-child(2) { width: 92%; margin-left: 4%; }
      .funnel-label-bar:nth-child(3) { width: 84%; margin-left: 8%; }
      .funnel-label-bar:nth-child(4) { width: 76%; margin-left: 12%; }
      .funnel-label-bar:nth-child(5) { width: 68%; margin-left: 16%; }
    }
    @keyframes ai-button-glow { 0%, 100% { box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 0 0 0 rgb(124 58 237 / 0.35); } 50% { box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 0 16px 2px rgb(124 58 237 / 0.35); } }
    @keyframes ai-bar-grow-1 { 0%, 100% { transform: scaleY(0.35); } 25% { transform: scaleY(1); } 50% { transform: scaleY(0.6); } 75% { transform: scaleY(0.9); } }
    @keyframes ai-bar-grow-2 { 0%, 100% { transform: scaleY(0.8); } 33% { transform: scaleY(0.45); } 66% { transform: scaleY(1); } }
    @keyframes ai-bar-grow-3 { 0%, 100% { transform: scaleY(0.5); } 20% { transform: scaleY(1); } 40% { transform: scaleY(0.4); } 70% { transform: scaleY(0.85); } }
    .ai-insights-trigger { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); color: #fff; border: none; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1); transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease; animation: ai-button-glow 2.2s ease-in-out infinite; }
    .ai-insights-trigger:hover { opacity: 0.95; background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%); box-shadow: 0 4px 12px -2px rgb(124 58 237 / 0.45); transform: translateY(-1px); animation: none; }
    .ai-insights-trigger:active { transform: translateY(0); box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1); }
    .ai-insights-trigger .ai-insights-icon { display: inline-flex; align-items: flex-end; }
    .ai-insights-trigger .ai-insights-bar { transform-origin: center bottom; }
    .ai-insights-trigger .ai-insights-bar-1 { animation: ai-bar-grow-1 2.4s ease-in-out infinite; }
    .ai-insights-trigger .ai-insights-bar-2 { animation: ai-bar-grow-2 2.8s ease-in-out infinite 0.3s; }
    .ai-insights-trigger .ai-insights-bar-3 { animation: ai-bar-grow-3 2.1s ease-in-out infinite 0.6s; }
    .ai-insights-trigger:hover .ai-insights-icon .ai-insights-bar { animation: none; transform: scaleY(1); }
    .ai-panel-open body.scroll-lock { overflow: hidden; }
    #export-report-type-dropdown.export-dropdown-fixed, #export-reports-dropdown.export-dropdown-fixed { position: fixed; z-index: 9999; }
    /* Insights chat panel — gradient chat style */
    #ai-insights-panel { border-radius: 16px; overflow: hidden; box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.2); right: 1.5rem; left: auto; top: 1.5rem; bottom: 1.5rem; max-width: 42rem; width: 100%; display: none; }
    #ai-insights-panel.ai-panel-visible { display: flex !important; }
    #ai-insights-panel-backdrop { display: none; }
    #ai-insights-panel-backdrop.ai-panel-visible { display: block !important; }
    .ai-reveal-step { opacity: 0; transform: translateY(10px); transition: opacity 0.45s ease, transform 0.45s ease; }
    @keyframes aiRevealIn { from { opacity: 0; transform: translateY(12px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
    .ai-reveal-step.visible { animation: aiRevealIn 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
    .ai-insights-skeleton { display: none; border-radius: 14px; border: 1px solid #e9d5ff; background: linear-gradient(180deg, #faf5ff 0%, #fff 100%); padding: 1.25rem 1.5rem; min-height: 180px; }
    .ai-chat-summary-card.loading .ai-insights-skeleton { display: block; }
    .ai-chat-summary-card-content { transition: opacity 0.4s ease; }
    .ai-chat-summary-card.loading .ai-chat-summary-card-content { opacity: 0; pointer-events: none; position: absolute; }
    .ai-chat-summary-card { position: relative; }
    .ai-insights-skeleton-line { height: 12px; border-radius: 6px; background: linear-gradient(90deg, #e9d5ff 25%, #f3e8ff 50%, #e9d5ff 75%); background-size: 200% 100%; animation: aiSkeletonShimmer 1.4s ease-in-out infinite; margin-bottom: 0.75rem; }
    .ai-insights-skeleton-line.short { width: 40%; }
    .ai-insights-skeleton-line.medium { width: 70%; }
    .ai-insights-skeleton-line.long { width: 95%; }
    @keyframes aiSkeletonShimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    #ai-insights-float-btn { position: fixed; right: 1.5rem; bottom: 1.5rem; z-index: 99; width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); color: #fff; border: none; box-shadow: 0 4px 20px rgba(124, 58, 237, 0.5); display: none; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    #ai-insights-float-btn:hover { transform: scale(1.08); box-shadow: 0 6px 24px rgba(124, 58, 237, 0.55); }
    #ai-insights-float-btn svg { width: 28px; height: 28px; }
    #ai-insights-float-btn.visible { display: flex !important; }
    .ai-chat-panel-header { background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 40%, #4f46e5 100%); color: #fff; padding: 1rem 1.25rem; display: flex; align-items: center; justify-content: space-between; gap: 0.75rem; }
    .ai-chat-panel-header-left { display: flex; align-items: center; gap: 0.75rem; min-width: 0; }
    .ai-chat-header-avatar { width: 40px; height: 40px; border-radius: 12px; background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .ai-chat-header-avatar svg { width: 22px; height: 22px; }
    .ai-chat-header-text { min-width: 0; }
    .ai-chat-header-title { font-size: 1rem; font-weight: 700; margin: 0; line-height: 1.2; }
    .ai-chat-header-tagline { font-size: 0.75rem; opacity: 0.9; margin: 0.25rem 0 0; }
    .ai-chat-header-controls { display: flex; align-items: center; gap: 0.25rem; flex-shrink: 0; }
    .ai-chat-header-controls button { width: 32px; height: 32px; border-radius: 8px; color: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
    .ai-chat-header-controls button:hover { background: rgba(255,255,255,0.15); color: #fff; }
    .ai-chat-greeting-wrap { display: flex; align-items: flex-start; gap: 0.5rem; margin-bottom: 1rem; }
    .ai-chat-greeting-avatar { width: 28px; height: 28px; border-radius: 8px; background: linear-gradient(135deg, #a78bfa 0%, #6366f1 100%); flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 1.125rem; line-height: 1; }
    .ai-chat-greeting-avatar svg { width: 14px; height: 14px; color: #fff; }
    .ai-chat-greeting-emoji { font-size: 1.125rem; line-height: 1; }
    .ai-chat-greeting-text { font-size: 0.875rem; color: #374151; margin: 0; padding: 0.5rem 0; }
    .ai-chat-suggestion-pill { background: #fff; border: 1.5px solid #c4b5fd; color: #5b21b6; border-radius: 9999px; padding: 0.375rem 0.75rem; font-size: 0.75rem; font-weight: 500; white-space: nowrap; flex-shrink: 0; transition: background 0.2s, border-color 0.2s, box-shadow 0.2s; }
    .ai-chat-suggestion-pill:hover { background: #f5f3ff; border-color: #a78bfa; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.15); }
    .ai-chat-bubble-user { max-width: 85%; margin-left: auto; margin-bottom: 1rem; background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 50%, #4f46e5 100%); color: #fff; border-radius: 18px 18px 4px 18px; padding: 12px 16px; font-size: 0.875rem; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3); }
    .ai-chat-bubble-bot { max-width: 90%; margin-right: auto; margin-bottom: 1rem; display: flex; align-items: flex-start; gap: 0.5rem; }
    .ai-chat-bubble-bot .ai-chat-bot-avatar { width: 28px; height: 28px; border-radius: 8px; background: linear-gradient(135deg, #a78bfa 0%, #6366f1 100%); flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
    .ai-chat-bubble-bot .ai-chat-bot-avatar svg { width: 14px; height: 14px; color: #fff; }
    .ai-chat-bubble-bot .ai-chat-bot-content { background: #f0f4fa; color: #3f4b63; border-radius: 14px 14px 14px 4px; padding: 12px 16px; font-size: 0.875rem; line-height: 1.45; }
    #ai-chat-messages { margin-top: 1.25rem; }
    #ai-chat-messages .ai-chat-bubble-user:last-child,
    #ai-chat-messages .ai-chat-bubble-bot:last-child { margin-bottom: 0.5rem; }
    .ai-chat-bubble-bot .ai-chat-bot-content p + p { margin-top: 0.5rem; }
    .ai-chat-bubble-bot .ai-chat-bot-content ul { margin: 0.5rem 0 0.75rem; padding-left: 1.25rem; }
    .ai-chat-bubble-bot .ai-chat-bot-content li { margin-bottom: 0.35rem; line-height: 1.45; }
    .ai-chat-follow-up-actions { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.75rem; }
    .ai-chat-action-btn { padding: 0.5rem 0.875rem; font-size: 0.8125rem; font-weight: 600; color: #5b21b6; background: #fff; border: 1.5px solid #c4b5fd; border-radius: 9999px; cursor: pointer; transition: background 0.2s, border-color 0.2s, box-shadow 0.2s; }
    .ai-chat-action-btn:hover { background: #f5f3ff; border-color: #a78bfa; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.15); }
    .ai-chat-send-btn { width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%); color: #fff; border: none; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4); transition: transform 0.2s, box-shadow 0.2s; }
    .ai-chat-send-btn:hover { transform: scale(1.05); box-shadow: 0 6px 16px rgba(124, 58, 237, 0.45); }
    .ai-chat-send-btn svg { width: 20px; height: 20px; }
    .ai-chat-input-wrap { display: flex; align-items: center; gap: 0.5rem; width: 100%; padding: 0.5rem 0.5rem 0.5rem 1.25rem; border: 1px solid #e5e7eb; border-radius: 9999px; background: #fff; transition: border-color 0.2s, box-shadow 0.2s; min-height: 3.5rem; }
    .ai-chat-input-wrap:focus-within { border-color: #a78bfa; box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.15); }
    .ai-chat-input-wrap input { border: none; background: transparent; padding: 0.6rem 0; min-height: 3rem; flex: 1; outline: none; font-size: 0.875rem; }
    .ai-chat-input-wrap input::placeholder { color: #9ca3af; }
    #ai-chat-conversation { scroll-behavior: smooth; padding-bottom: 0; }
    .ai-chat-welcome-section { margin-bottom: 2rem; }
    .ai-chat-welcome-section:last-child { margin-bottom: 0.375rem; }
    .ai-chat-section-label { display: flex; align-items: center; gap: 0.5rem; font-size: 0.8125rem; font-weight: 600; color: #5b21b6; margin-bottom: 0.5rem; }
    .ai-chat-section-label svg { width: 16px; height: 16px; flex-shrink: 0; opacity: 0.9; }
    .ai-chat-summary-card { border-radius: 14px; border: 1px solid #e9d5ff; background: linear-gradient(180deg, #faf5ff 0%, #fff 100%); padding: 1.25rem 1.5rem; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.08), 0 1px 2px rgba(0,0,0,0.04); }
    .ai-chat-summary-card .ai-chat-action-label { font-size: 0.8125rem; font-weight: 700; color: #5b21b6; letter-spacing: 0.02em; margin-top: 0; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.4rem; }
    .ai-chat-summary-card .ai-chat-key-insights-icon { width: 1rem; height: 1rem; flex-shrink: 0; color: #7c3aed; }
    .ai-chat-summary-card .ai-chat-action-label:not(:first-child) { margin-top: 1.25rem; padding-top: 1.25rem; border-top: 1px solid #ede9fe; }
    .ai-chat-summary-card .ai-chat-metrics { font-size: 0.875rem; line-height: 1.7; color: #4b5563; margin: 0; }
    .ai-chat-summary-card .ai-chat-metrics .metric-line { display: block; padding: 0.15rem 0; }
    .ai-chat-summary-card .ai-chat-metrics strong { color: #1f2937; font-weight: 700; }
    .ai-chat-summary-card .metric-down { color: #b91c1c; font-weight: 600; }
    .ai-chat-summary-card .metric-up { color: #15803d; font-weight: 600; }
    .ai-chat-summary-card ul { padding-left: 1.35rem; margin: 0.25rem 0 0; list-style: none; }
    .ai-chat-summary-card ul li { position: relative; margin-bottom: 0.5rem; line-height: 1.5; padding-left: 0.5rem; font-size: 0.875rem; color: #4b5563; }
    .ai-chat-summary-card ul li::before { content: ''; position: absolute; left: -1rem; top: 0.5em; width: 5px; height: 5px; border-radius: 50%; background: #7c3aed; opacity: 0.8; }
    .ai-chat-help-prompt { font-size: 0.8125rem; color: #6b7280; line-height: 1.5; margin-bottom: 0.5rem; }
    .ai-chat-try-asking { font-size: 0.75rem; color: #6b7280; background: #f9fafb; border-radius: 10px; padding: 0.75rem 1rem; border: 1px dashed #e5e7eb; margin-top: 0.5rem; }
    .ai-chat-try-asking strong { color: #374151; font-weight: 600; }
    .ai-chat-quick-link-card { border-radius: 10px; border: 1px solid #e5e7eb; background: #fff; padding: 0.75rem 1rem; transition: background 0.2s, border-color 0.2s, box-shadow 0.2s; }
    .ai-chat-quick-link-card:hover { background: #faf5ff; border-color: #e9d5ff; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.08); }
    .ai-chat-quick-link-card .ai-chat-quick-badge { font-size: 0.6875rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.04em; color: #7c3aed; margin-bottom: 0.25rem; }
    .ai-chat-quick-link-card.needs-attention .ai-chat-quick-badge { color: #b45309; }
    /* V1.1 sidenav (collapsible) */
    .sidenav-expanded { width: 16rem; transition: width 0.3s ease-in-out; }
    .sidenav-collapsed { width: 4rem; transition: width 0.3s ease-in-out; }
    .sidenav-collapsed .sidenav-label, .sidenav-collapsed .sidenav-chevron, .sidenav-collapsed .sidenav-section-header, .sidenav-collapsed .sidenav-children, .sidenav-collapsed .sidenav-child-item { opacity: 0; width: 0; overflow: hidden; display: none; transition: opacity 0.2s ease-in-out; }
    .sidenav-collapsed .sidenav-create-btn { padding-left: 0; padding-right: 0; justify-content: center; }
    .sidenav-collapsed nav { padding-left: 0.25rem; padding-right: 0.25rem; }
    .sidenav-collapsed nav ul li a, .sidenav-collapsed nav ul li button { justify-content: center; padding-left: 0.5rem; padding-right: 0.5rem; }
    .sidenav-collapsed nav ul li a > div, .sidenav-collapsed nav ul li button > div { justify-content: center; }
    .sidenav-toggle-btn { z-index: 100; }
    .compare-table-wrap .sticky-col { position: sticky; left: 0; background: #fff; z-index: 1; box-shadow: 2px 0 4px rgba(0,0,0,0.04); }
    .export-toast { position: fixed; bottom: 1.5rem; left: 50%; transform: translateX(-50%); padding: 0.75rem 1.25rem; background: #313b4d; /* neutral-950 */ color: #fff; font-size: 0.875rem; font-weight: 500; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 9999; transition: opacity 0.25s ease, transform 0.25s ease; }
    .export-toast.hidden { opacity: 0; pointer-events: none; transform: translateX(-50%) translateY(8px); }
    .accounts-expand-btn { transition: transform 0.2s ease; }
    .accounts-expand-btn.expanded { transform: rotate(90deg); }
    .accounts-child-row { display: table-row; }
    .accounts-child-row.hidden { display: none; }
    .accounts-child-row td { background: #fafbfc; border-bottom: 1px solid #f0f4fa; }
    .accounts-child-row td.sticky-col { background: #fafbfc; }
    .campaigns-expand-btn { transition: transform 0.2s ease; }
    .campaigns-expand-btn.expanded { transform: rotate(90deg); }
    .campaigns-child-row { display: table-row; }
    .campaigns-child-row.hidden { display: none; }
    .campaigns-child-row td { background: #fafbfc; border-bottom: 1px solid #f0f4fa; }
    .campaigns-child-row td.sticky-col { background: #fafbfc; }
    .campaigns-account-expand-btn { transition: transform 0.2s ease; }
    .campaigns-account-expand-btn.expanded { transform: rotate(90deg); }
    .campaigns-location-row { display: table-row; }
    .campaigns-location-row.hidden { display: none; }
    .campaigns-location-row td { background: #f5f6f8; border-bottom: 1px solid #eef0f4; }
    .campaigns-location-row td.sticky-col { background: #f5f6f8; }
    @media (max-width: 479px) {
      .main-content-inner { padding: 0 0.75rem; }
      .sticky-header { margin-left: 0; margin-right: 0; padding-left: 0; padding-right: 0; }
      .sticky-header.is-stuck { margin-left: -0.75rem; margin-right: -0.75rem; padding-left: 0.75rem; padding-right: 0.75rem; }
      .compare-table-wrap .sticky-col { left: 0; }
      #export-modal .max-w-md { margin: 0.5rem; max-height: calc(100vh - 1rem); overflow: auto; }
      #ai-insights-panel { right: 0.5rem; left: auto; top: 0.5rem; bottom: 0.5rem; max-width: none; max-height: none; }
    }
  </style>
</head>
<body class="font-sans text-neutral-900 antialiased bg-white" id="body-el">
  <!-- Top Navigation Bar (V1.1) -->
  <nav class="bg-white border-b border-neutral-300 px-4 md:px-6 lg:px-8 py-3 flex items-center justify-between">
    <div class="flex items-center">
      <button onclick="toggleSidebar()" class="lg:hidden p-2 text-neutral-600 hover:text-neutral-900 rounded-md hover:bg-neutral-200 transition-colors mr-3" aria-label="Menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
      <a href="org-dashboard-v1.1.html"><img src="assets/ctctLogo.png" alt="Constant Contact" class="w-10 h-10 object-contain"></a>
    </div>
    <div class="flex items-center gap-3">
      <div class="w-8 h-8 bg-neutral-800 rounded-full flex items-center justify-center">
        <span class="text-sm font-medium text-white">UG</span>
      </div>
      <span class="text-sm font-medium text-neutral-900 hidden md:inline">UPS Global</span>
      <button class="hidden sm:inline-flex items-center justify-center rounded-lg p-2.5 text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100" aria-label="Help">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
      </button>
    </div>
  </nav>

  <div class="flex min-h-0 pb-6">
    <div id="sidebar-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden" onclick="toggleSidebar()"></div>
    <aside id="sidebar" class="fixed lg:sticky inset-y-0 left-0 transform -translate-x-full lg:translate-x-0 transition-all duration-300 ease-in-out z-50 lg:z-auto w-64 bg-white border-r border-neutral-200 flex flex-col sidenav-expanded lg:top-0 lg:h-screen lg:overflow-y-auto lg:flex-shrink-0">
      <div id="sidebar-content" class="relative h-full overflow-visible"></div>
    </aside>
    <script src="components/left-nav.js"></script>

    <main class="flex-1 p-4 sm:p-6 lg:p-8 bg-white min-w-0">
      <div class="main-content-wrap">
        <div class="main-content-inner">
          <nav class="flex items-center gap-2 text-sm text-neutral-500 mb-2" aria-label="Breadcrumb">
            <a href="org-dashboard-m2.html" class="hover:text-neutral-700">Dashboard</a>
            <span class="mx-1">›</span>
            <span class="text-neutral-700 font-medium">Email engagement</span>
          </nav>

          <h1 class="text-2xl font-semibold text-neutral-900 mb-2">Email engagement report</h1>
          <p class="text-sm text-neutral-600 mb-[40px] whitespace-nowrap">Monitor email engagement across all your accounts and campaigns. Use the global filters to adjust the campaign scope, time range, and account view for more precise, relevant insights.</p>
          <div id="sticky-header-sentinel" class="h-px w-full" aria-hidden="true"></div>
          <header class="sticky-header" id="sticky-header">
            <div class="flex flex-wrap items-center justify-between gap-4">
              <div class="flex flex-wrap items-center gap-3">
                <p class="text-base text-neutral-900 mb-0 mr-1">Viewing Reports for:</p>
                <div class="flex rounded-lg border border-neutral-200 p-0.5 bg-neutral-50/50" role="group">
                  <button type="button" class="segment-btn px-3 py-1.5 text-sm font-semibold rounded-md bg-white text-neutral-900 shadow-sm" data-segment="all">All Campaigns</button>
                  <button type="button" class="segment-btn px-3 py-1.5 text-sm font-medium rounded-md text-neutral-600 hover:text-neutral-900" data-segment="central">Central Send</button>
                  <button type="button" class="segment-btn px-3 py-1.5 text-sm font-medium rounded-md text-neutral-600 hover:text-neutral-900" data-segment="franchise">Franchise Sent</button>
                </div>
                <span class="inline-block w-px h-6 bg-neutral-200 flex-shrink-0" aria-hidden="true"></span>
                <div class="relative">
                  <button type="button" id="date-range-trigger" class="rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm text-left flex items-center gap-2 min-w-[140px]">
                    <svg class="w-4 h-4 text-neutral-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M5 4h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/><path d="M16 2v4"/><path d="M8 2v4"/><path d="M3 10h18"/></svg>
                    <span id="date-range-label" class="font-semibold">Last 30 days</span>
                    <svg class="w-4 h-4 text-neutral-500 ml-auto flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                  </button>
                  <div id="date-range-dropdown" class="hidden absolute left-0 top-full mt-1 w-64 rounded-lg border border-neutral-200 bg-white py-1 shadow-lg z-50 overflow-hidden" onclick="event.stopPropagation()">
                    <button type="button" class="date-range-option w-full px-3 py-2 text-left text-sm hover:bg-neutral-50 flex flex-col items-start gap-0.5" data-value="7">
                      <span>Last 7 days</span>
                      <span class="date-range-dates text-xs text-neutral-500 font-normal" id="date-range-preview-7"></span>
                    </button>
                    <button type="button" class="date-range-option w-full px-3 py-2 text-left text-sm hover:bg-neutral-50 flex flex-col items-start gap-0.5" data-value="30">
                      <span>Last 30 days</span>
                      <span class="date-range-dates text-xs text-neutral-500 font-normal" id="date-range-preview-30"></span>
                    </button>
                    <button type="button" class="date-range-option w-full px-3 py-2 text-left text-sm hover:bg-neutral-50 flex flex-col items-start gap-0.5" data-value="90">
                      <span>Last 90 days</span>
                      <span class="date-range-dates text-xs text-neutral-500 font-normal" id="date-range-preview-90"></span>
                    </button>
                    <button type="button" class="date-range-option w-full px-3 py-2 text-left text-sm hover:bg-neutral-50 flex flex-col items-start gap-0.5" data-value="365">
                      <span>12 months</span>
                      <span class="date-range-dates text-xs text-neutral-500 font-normal" id="date-range-preview-365"></span>
                    </button>
                    <button type="button" class="date-range-option w-full px-3 py-2 text-left text-sm hover:bg-neutral-50 flex flex-col items-start gap-0.5" data-value="ytd">
                      <span>Year to date</span>
                      <span class="date-range-dates text-xs text-neutral-500 font-normal" id="date-range-preview-ytd"></span>
                    </button>
                    <div class="border-t border-neutral-100 pt-1 mt-1">
                      <button type="button" id="date-range-custom-btn" class="w-full px-3 py-2 text-left text-sm hover:bg-neutral-50">Custom range...</button>
                      <div id="date-range-custom-panel" class="hidden px-3 pb-3 pt-1 border-t border-neutral-100 mt-1">
                        <div class="grid grid-cols-2 gap-2 mb-2">
                          <div>
                            <label for="date-range-start" class="block text-xs font-medium text-neutral-500 mb-0.5">From</label>
                            <input type="date" id="date-range-start" class="w-full rounded border border-neutral-200 px-2 py-1.5 text-sm">
                          </div>
                          <div>
                            <label for="date-range-end" class="block text-xs font-medium text-neutral-500 mb-0.5">To</label>
                            <input type="date" id="date-range-end" class="w-full rounded border border-neutral-200 px-2 py-1.5 text-sm">
                          </div>
                        </div>
                        <button type="button" id="date-range-apply" class="w-full rounded-lg bg-main-600 text-white px-3 py-1.5 text-sm font-medium hover:bg-main-700">Apply</button>
                      </div>
                    </div>
                  </div>
                </div>
                <span class="inline-block w-px h-6 bg-neutral-200 flex-shrink-0" aria-hidden="true"></span>
                <div class="relative" id="accounts-multiselect-wrap">
                  <button type="button" id="accounts-multiselect-trigger" class="w-56 rounded-lg border border-neutral-200 bg-white pl-10 pr-9 py-2 text-sm text-left flex items-center gap-2 focus:ring-2 focus:ring-main-500 focus:border-transparent" aria-haspopup="listbox" aria-expanded="false">
                    <svg class="w-4 h-4 text-neutral-500 absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 21h18"/><path d="M3 10h18"/><path d="M5 6l7-3 7 3"/><path d="M4 10v11"/><path d="M20 10v11"/><path d="M8 14v3"/><path d="M12 14v3"/><path d="M16 14v3"/></svg>
                    <span id="accounts-multiselect-label" class="text-neutral-900 truncate font-semibold">All accounts</span>
                    <svg class="w-4 h-4 text-neutral-500 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                  </button>
                  <div id="accounts-multiselect-dropdown" class="hidden absolute left-0 top-full mt-1 w-56 rounded-lg border border-neutral-200 bg-white py-2 shadow-lg z-50 max-h-60 overflow-y-auto" role="listbox">
                    <div class="px-3 py-1.5 border-b border-neutral-100 flex items-center justify-between">
                      <span class="text-xs font-medium text-neutral-500 uppercase tracking-wide">Accounts</span>
                      <button type="button" id="accounts-multiselect-clear" class="text-xs font-medium text-main-600 hover:underline disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:no-underline disabled:text-neutral-400" disabled>Clear</button>
                    </div>
                    <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer">
                      <input type="checkbox" class="accounts-multiselect-check rounded border-neutral-300" data-account="all" checked>
                      <span class="text-sm text-neutral-800">All accounts</span>
                    </label>
                    <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer">
                      <input type="checkbox" class="accounts-multiselect-check rounded border-neutral-300" data-account="UPS Northeast">
                      <span class="text-sm text-neutral-800">UPS Northeast</span>
                    </label>
                    <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer">
                      <input type="checkbox" class="accounts-multiselect-check rounded border-neutral-300" data-account="UPS Southeast">
                      <span class="text-sm text-neutral-800">UPS Southeast</span>
                    </label>
                    <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer">
                      <input type="checkbox" class="accounts-multiselect-check rounded border-neutral-300" data-account="UPS Midwest">
                      <span class="text-sm text-neutral-800">UPS Midwest</span>
                    </label>
                    <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer">
                      <input type="checkbox" class="accounts-multiselect-check rounded border-neutral-300" data-account="UPS Southwest">
                      <span class="text-sm text-neutral-800">UPS Southwest</span>
                    </label>
                    <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer">
                      <input type="checkbox" class="accounts-multiselect-check rounded border-neutral-300" data-account="UPS West">
                      <span class="text-sm text-neutral-800">UPS West</span>
                    </label>
                  </div>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <div class="relative ai-insights-float view-insights-sticky-only">
                  <button type="button" class="ai-insights-trigger rounded-lg px-4 py-2 text-sm font-medium text-white" aria-label="Start insights chat" onclick="(window.openAiPanel || window.openAiInsightsPanel)(); if(event) event.stopPropagation();">
                    <svg class="ai-insights-icon w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    Start insights chat
                  </button>
                </div>
                <button type="button" id="export-btn" class="rounded-lg bg-main-600 text-white px-6 py-2 text-sm font-medium hover:bg-main-700 min-w-[100px]">Export report</button>
              </div>
            </div>
          </header>

          <!-- Export Modal -->
          <div id="export-modal" class="fixed inset-0 z-[9998] hidden" aria-hidden="true">
            <div class="absolute inset-0 bg-black/40" id="export-modal-backdrop"></div>
            <div class="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md rounded-xl border border-neutral-200 bg-white shadow-xl max-h-[90vh] flex flex-col">
              <div class="border-b border-neutral-100 px-6 py-4 flex-shrink-0">
                <h3 class="text-lg font-semibold text-neutral-900">Choose a report to export</h3>
              </div>
              <div id="export-modal-body" class="px-6 py-4 space-y-4 flex-1 min-h-0">
                <div class="relative">
                  <label class="block text-sm font-medium text-neutral-700 mb-1">Report type</label>
                  <button type="button" id="export-report-type-trigger" class="w-full flex items-center justify-between rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm text-left">
                    <span id="export-report-type-label">CSV</span>
                    <svg class="w-4 h-4 text-neutral-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                  </button>
                  <div id="export-report-type-dropdown" class="hidden absolute left-0 right-0 top-full mt-1 rounded-lg border border-neutral-200 bg-white py-1 shadow-xl z-[100]">
                    <button type="button" class="export-type-option w-full px-3 py-2 text-left text-sm hover:bg-neutral-50" data-value="CSV">CSV</button>
                    <button type="button" class="export-type-option w-full px-3 py-2 text-left text-sm hover:bg-neutral-50" data-value="PDF">PDF</button>
                  </div>
                </div>
                <div class="relative">
                  <label class="block text-sm font-medium text-neutral-700 mb-1">Reports</label>
                  <button type="button" id="export-reports-trigger" class="w-full flex items-center justify-between rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm text-left">
                    <span id="export-reports-label">Select reports</span>
                    <svg class="w-4 h-4 text-neutral-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                  </button>
                  <div id="export-reports-dropdown" class="hidden absolute left-0 right-0 top-full mt-1 rounded-lg border border-neutral-200 bg-white py-1 shadow-xl max-h-60 overflow-auto z-[100]">
                    <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer">
                      <input type="checkbox" class="export-report-check rounded border-neutral-300" data-report="Full report" id="export-check-full">
                      <span class="text-sm">Full report</span>
                    </label>
                    <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer">
                      <input type="checkbox" class="export-report-check rounded border-neutral-300" data-report="Engagement funnel">
                      <span class="text-sm">Engagement funnel</span>
                    </label>
                    <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer">
                      <input type="checkbox" class="export-report-check rounded border-neutral-300" data-report="Engagement by accounts">
                      <span class="text-sm">Engagement by accounts</span>
                    </label>
                    <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer">
                      <input type="checkbox" class="export-report-check rounded border-neutral-300" data-report="Engagement by campaign">
                      <span class="text-sm">Engagement by campaign</span>
                    </label>
                    <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer">
                      <input type="checkbox" class="export-report-check rounded border-neutral-300" data-report="Deliverability">
                      <span class="text-sm">Deliverability</span>
                    </label>
                  </div>
                </div>
              </div>
              <div class="flex justify-end gap-2 border-t border-neutral-100 px-6 py-4 flex-shrink-0">
                <button type="button" id="export-modal-cancel" class="rounded-lg border border-neutral-300 bg-white px-4 py-2 text-sm font-medium text-neutral-700 hover:bg-neutral-50">Cancel</button>
                <button type="button" id="export-modal-export" class="rounded-lg bg-main-600 px-4 py-2 text-sm font-medium text-white hover:bg-main-700">Export</button>
              </div>
            </div>
          </div>

          <!-- Insights -->
          <section id="performance-funnel-section" class="mb-8 pt-0">
            <div class="funnel-card overflow-hidden bg-purple-50 border-purple-200">
              <div class="funnel-card-header border-b border-purple-200/60 bg-purple-50/80 px-6 py-4">
                <div class="flex flex-wrap items-center justify-between gap-4">
                  <div>
                    <div class="flex flex-wrap items-center gap-2">
                      <h2 class="text-lg font-semibold text-neutral-900">Insights</h2>
                    </div>
                    <p class="mt-1 text-sm text-neutral-700">Key highlights summarizing performance trends, strengths, and opportunities.</p>
                  </div>
                  <button type="button" class="ai-insights-trigger rounded-lg px-4 py-2 text-sm font-medium text-white flex-shrink-0 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-main-600" id="ai-insights-trigger" aria-label="Start insights chat" onclick="(window.openAiPanel || window.openAiInsightsPanel)(); if(event) event.stopPropagation();">
                    <svg class="ai-insights-icon w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    Start insights chat
                  </button>
                </div>
              </div>
              <div class="p-6 pt-5">
                <div class="flex flex-wrap items-center gap-1.5 mb-5 pt-1" role="tablist" aria-label="Insights type">
                  <button type="button" role="tab" id="insights-tab-email" class="insights-tag active inline-flex items-center rounded-md bg-neutral-800 px-2.5 py-1 text-xs font-medium text-white hover:bg-neutral-700 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-neutral-800" data-insight-tag="email" aria-pressed="true" aria-selected="true" tabindex="0">Email insights</button>
                  <button type="button" role="tab" id="insights-tab-account" class="insights-tag inline-flex items-center rounded-md bg-neutral-800 px-2.5 py-1 text-xs font-medium text-white hover:bg-neutral-700 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-neutral-800" data-insight-tag="account" aria-pressed="false" aria-selected="false" tabindex="-1">Account insights</button>
                  <button type="button" role="tab" id="insights-tab-campaign" class="insights-tag inline-flex items-center rounded-md bg-neutral-800 px-2.5 py-1 text-xs font-medium text-white hover:bg-neutral-700 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-neutral-800" data-insight-tag="campaign" aria-pressed="false" aria-selected="false" tabindex="-1">Campaign insights</button>
                </div>
                <div id="insights-panel-email" class="insights-panel" role="tabpanel" aria-labelledby="insights-tab-email">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6" role="list" aria-label="Summary metrics">
                  <article class="funnel-card p-4 bg-white" aria-labelledby="summary-title-1" role="listitem">
                    <div class="flex items-center gap-3 mb-3">
                      <span class="insight-card-icon-bg flex h-10 w-10 items-center justify-center rounded-lg text-main-700" aria-hidden="true">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                      </span>
                      <h3 id="summary-title-1" class="text-sm font-medium text-neutral-600 m-0">Emails sent</h3>
                    </div>
                    <p id="summary-emails-sent" class="text-2xl font-bold text-neutral-900">8.99M</p>
                    <p class="text-sm mt-1" aria-label="Trend: increased 5.2 percent versus last period"><span id="summary-emails-sent-trend" class="font-semibold text-green-700">+5.2% vs last period</span></p>
                    <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">Reach is up. Keep using segmentation so messages stay relevant to each audience.</p>
                  </article>
                  <article class="funnel-card p-4 bg-white" aria-labelledby="summary-title-2" role="listitem">
                    <div class="flex items-center gap-3 mb-3">
                      <span class="insight-card-icon-bg flex h-10 w-10 items-center justify-center rounded-lg text-main-700" aria-hidden="true">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      </span>
                      <h3 id="summary-title-2" class="text-sm font-medium text-neutral-600 m-0">Delivery rate</h3>
                    </div>
                    <p id="summary-delivery-rate" class="text-2xl font-bold text-neutral-900">99.4%</p>
                    <p class="text-sm mt-1 font-semibold text-green-700" aria-label="8.63 million delivered, trend up"><span id="summary-delivered">8.63M</span> delivered</p>
                    <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">Messages are reaching the inbox. Low bounce and spam complaint rates support a healthy sender reputation.</p>
                  </article>
                  <article class="funnel-card p-4 bg-white" aria-labelledby="summary-title-3" role="listitem">
                    <div class="flex items-center gap-3 mb-3">
                      <span class="insight-card-icon-bg flex h-10 w-10 items-center justify-center rounded-lg text-main-700" aria-hidden="true">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                      </span>
                      <h3 id="summary-title-3" class="text-sm font-medium text-neutral-600 m-0">Open rate</h3>
                    </div>
                    <p id="summary-open-rate" class="text-2xl font-bold text-neutral-900">65.0%</p>
                    <p class="text-sm mt-1" aria-label="Trend: decreased 7.8 percent versus last period"><span id="summary-open-rate-trend" class="font-semibold text-red-700">-7.8% vs last period</span></p>
                    <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">Open rate is down. Test subject lines and send times (A/B tests) to improve engagement.</p>
                  </article>
                  <article class="funnel-card p-4 bg-white" aria-labelledby="summary-title-4" role="listitem">
                    <div class="flex items-center gap-3 mb-3">
                      <span class="insight-card-icon-bg flex h-10 w-10 items-center justify-center rounded-lg text-main-700" aria-hidden="true">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                      </span>
                      <h3 id="summary-title-4" class="text-sm font-medium text-neutral-600 m-0">Bounce rate</h3>
                    </div>
                    <p id="summary-bounce-rate" class="text-2xl font-bold text-neutral-900">0.6%</p>
                    <p class="text-sm mt-1" aria-label="Trend: decreased 10.7 percent versus last period, improvement"><span id="summary-bounce-rate-trend" class="font-semibold text-green-700">-10.7% vs last period</span></p>
                    <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">Bounce rate improved. List quality and hygiene are working; continue suppressing hard bounces.</p>
                  </article>
                </div>
                </div>

                <div id="insights-panel-account" class="insights-panel hidden" role="tabpanel" aria-labelledby="insights-tab-account" aria-hidden="true">
                  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6" role="list" aria-label="Account summary metrics">
                    <article class="funnel-card p-4 bg-white" aria-labelledby="account-summary-title-1" role="listitem">
                      <div class="flex items-center gap-3 mb-3">
                        <span class="insight-card-icon-bg flex h-10 w-10 items-center justify-center rounded-lg text-main-700" aria-hidden="true">
                          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </span>
                        <h3 id="account-summary-title-1" class="text-sm font-medium text-neutral-600 m-0">Top performer</h3>
                      </div>
                      <p class="text-2xl font-bold text-neutral-900">UPS Northeast</p>
                      <p class="text-sm mt-1 font-semibold text-green-700">72% open, 31% CTR</p>
                      <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">Highest engagement in the selected period. Strong subject lines and segment targeting.</p>
                    </article>
                    <article class="funnel-card p-4 bg-white" aria-labelledby="account-summary-title-2" role="listitem">
                      <div class="flex items-center gap-3 mb-3">
                        <span class="flex h-10 w-10 items-center justify-center rounded-lg bg-warning-100 text-warning-700" aria-hidden="true">
                          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                        </span>
                        <h3 id="account-summary-title-2" class="text-sm font-medium text-neutral-600 m-0">Needs attention</h3>
                      </div>
                      <p class="text-2xl font-bold text-neutral-900">UPS Midwest</p>
                      <p class="text-sm mt-1 font-semibold text-red-700">Open rate below 50%</p>
                      <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">Consider list hygiene and send time tests. Low engagement may affect deliverability.</p>
                    </article>
                    <article class="funnel-card p-4 bg-white" aria-labelledby="account-summary-title-3" role="listitem">
                      <div class="flex items-center gap-3 mb-3">
                        <span class="insight-card-icon-bg flex h-10 w-10 items-center justify-center rounded-lg text-main-700" aria-hidden="true">
                          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                        </span>
                        <h3 id="account-summary-title-3" class="text-sm font-medium text-neutral-600 m-0">Total accounts</h3>
                      </div>
                      <p class="text-2xl font-bold text-neutral-900">6</p>
                      <p class="text-sm mt-1 text-neutral-700">Active in period</p>
                      <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">All accounts with sends in the selected date range.</p>
                    </article>
                    <article class="funnel-card p-4 bg-white" aria-labelledby="account-summary-title-4" role="listitem">
                      <div class="flex items-center gap-3 mb-3">
                        <span class="insight-card-icon-bg flex h-10 w-10 items-center justify-center rounded-lg text-main-700" aria-hidden="true">
                          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                        </span>
                        <h3 id="account-summary-title-4" class="text-sm font-medium text-neutral-600 m-0">Avg. open rate</h3>
                      </div>
                      <p class="text-2xl font-bold text-neutral-900">65.0%</p>
                      <p class="text-sm mt-1 text-neutral-700">Across accounts</p>
                      <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">Weighted average open rate for the selected period.</p>
                    </article>
                  </div>
                </div>

                <div id="insights-panel-campaign" class="insights-panel hidden" role="tabpanel" aria-labelledby="insights-tab-campaign" aria-hidden="true">
                  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6" role="list" aria-label="Campaign summary metrics">
                    <article class="funnel-card p-4 bg-white" aria-labelledby="campaign-summary-title-1" role="listitem">
                      <div class="flex items-center gap-3 mb-3">
                        <span class="insight-card-icon-bg flex h-10 w-10 items-center justify-center rounded-lg text-main-700" aria-hidden="true">
                          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                        </span>
                        <h3 id="campaign-summary-title-1" class="text-sm font-medium text-neutral-600 m-0">Campaigns sent</h3>
                      </div>
                      <p class="text-2xl font-bold text-neutral-900">1,240</p>
                      <p class="text-sm mt-1 text-neutral-700">In selected period</p>
                      <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">Total campaigns with at least one send in the date range.</p>
                    </article>
                    <article class="funnel-card p-4 bg-white" aria-labelledby="campaign-summary-title-2" role="listitem">
                      <div class="flex items-center gap-3 mb-3">
                        <span class="insight-card-icon-bg flex h-10 w-10 items-center justify-center rounded-lg text-main-700" aria-hidden="true">
                          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                        </span>
                        <h3 id="campaign-summary-title-2" class="text-sm font-medium text-neutral-600 m-0">Top campaign</h3>
                      </div>
                      <p class="text-2xl font-bold text-neutral-900">Q1 Newsletter</p>
                      <p class="text-sm mt-1 font-semibold text-green-700">66.6% open, 26.6% CTR</p>
                      <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">Highest engagement. Central send with strong creative and targeting.</p>
                    </article>
                    <article class="funnel-card p-4 bg-white" aria-labelledby="campaign-summary-title-3" role="listitem">
                      <div class="flex items-center gap-3 mb-3">
                        <span class="flex h-10 w-10 items-center justify-center rounded-lg bg-warning-100 text-warning-700" aria-hidden="true">
                          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </span>
                        <h3 id="campaign-summary-title-3" class="text-sm font-medium text-neutral-600 m-0">Low performers</h3>
                      </div>
                      <p class="text-2xl font-bold text-neutral-900">12</p>
                      <p class="text-sm mt-1 font-semibold text-red-700">Below 40% open</p>
                      <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">Campaigns with open rate under 40%. Review subject lines and list quality.</p>
                    </article>
                    <article class="funnel-card p-4 bg-white" aria-labelledby="campaign-summary-title-4" role="listitem">
                      <div class="flex items-center gap-3 mb-3">
                        <span class="insight-card-icon-bg flex h-10 w-10 items-center justify-center rounded-lg text-main-700" aria-hidden="true">
                          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                        </span>
                        <h3 id="campaign-summary-title-4" class="text-sm font-medium text-neutral-600 m-0">Avg. click rate</h3>
                      </div>
                      <p class="text-2xl font-bold text-neutral-900">26.2%</p>
                      <p class="text-sm mt-1 text-neutral-700">Across campaigns</p>
                      <p class="text-xs text-neutral-700 mt-2 pt-2 border-t border-neutral-200">Weighted average click-through rate for the selected period.</p>
                    </article>
                  </div>
                </div>

                <footer class="mt-2 pt-2" role="contentinfo">
                  <p class="text-xs text-neutral-700"><span aria-hidden="true">*</span> Insights are derived from your data for the selected time period.</p>
                </footer>

                <!-- Key insight (inline) -->
                <div class="mt-8 pt-6 border-t border-neutral-100 hidden">
                  <div class="rounded-lg border border-purple-200 bg-purple-50 p-4">
                    <p class="text-sm font-semibold text-neutral-800 mb-0.5">AI Summary</p>
                    <p class="text-xs text-neutral-500 mb-3">Key drivers of your funnel performance this period</p>
                    <ul class="space-y-1.5 text-sm text-neutral-700 mb-4">
                      <li><span class="font-medium">🟢 Strong:</span> Send volume up (+5.2%), bounce rate improved</li>
                      <li><span class="font-medium">🔴 Attention:</span> Opens (-7.8%) and clicks (-4.4%) declined</li>
                      <li><span class="font-medium">🎯 Opportunity:</span> Optimize CTAs and segmentation to improve conversion</li>
                    </ul>
                    <label for="funnel-ask-input" class="block text-sm font-medium text-neutral-700 mb-1">Ask the AI coach about your performance</label>
                    <div class="flex gap-2">
                      <input type="text" id="funnel-ask-input" placeholder="Why did my engagement change?" class="flex-1 rounded-lg border border-neutral-200 px-3 py-2 text-sm focus:ring-2 focus:ring-main-500 focus:border-transparent" />
                      <button type="button" id="funnel-ask-btn" class="rounded-lg bg-main-600 px-3 py-2 text-sm font-medium text-white hover:bg-main-700">Get recommendations</button>
                    </div>
                    <p class="text-xs text-neutral-400 mt-3 pt-3 border-t border-purple-200/60">Based on 8.99M sends and 8.63M deliveries in the selected period</p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Engagement funnel -->
          <section id="performance-funnel-section-2" class="mb-8">
            <div class="funnel-card overflow-hidden bg-white">
              <div class="funnel-card-header border-b border-neutral-100 px-6 py-5">
                <h2 class="text-lg font-semibold text-neutral-900 tracking-tight">Engagement funnel</h2>
                <p class="mt-1 text-sm text-neutral-700">Visualize audience engagement across each stage of the funnel for the selected period.</p>
              </div>
              <div class="p-6">
                <div class="funnel-wrapper">
                  <div class="funnel-viz">
                    <div class="funnel-segment funnel-segment-1" data-funnel-stage="1"></div>
                    <div class="funnel-segment funnel-segment-2" data-funnel-stage="2"></div>
                    <div class="funnel-segment funnel-segment-3" data-funnel-stage="3"></div>
                    <div class="funnel-segment funnel-segment-4" data-funnel-stage="4"></div>
                    <div class="funnel-segment funnel-segment-5" data-funnel-stage="5"></div>
                  </div>
                  <div class="funnel-labels">
                    <div class="funnel-label-bar funnel-segment-1" data-funnel-stage="1">
                      <span class="funnel-label-left">
                        <svg class="funnel-strip-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                        <span>Emails sent</span>
                      </span>
                      <span class="funnel-label-right">
                        <span id="funnel-value-1-copy" class="funnel-stage-value font-semibold">8.99M</span>
                        <span id="funnel-delta-1-copy" class="funnel-stage-delta positive">+5.2%</span>
                      </span>
                    </div>
                    <div class="funnel-label-bar funnel-segment-2" data-funnel-stage="2">
                      <span class="funnel-label-left">
                        <svg class="funnel-strip-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <span>Emails delivered</span>
                      </span>
                      <span class="funnel-label-right">
                        <span id="funnel-value-2-copy" class="funnel-stage-value font-semibold">8.63M</span>
                        <span id="funnel-delta-2-copy" class="funnel-stage-delta negative">-4.0%</span>
                      </span>
                    </div>
                    <div class="funnel-label-bar funnel-segment-3" data-funnel-stage="3">
                      <span class="funnel-label-left">
                        <svg class="funnel-strip-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                        <span>Opened</span>
                      </span>
                      <span class="funnel-label-right">
                        <span id="funnel-value-3-copy" class="funnel-stage-value font-semibold">5.61M</span>
                        <span id="funnel-delta-3-copy" class="funnel-stage-delta negative">-7.8%</span>
                      </span>
                    </div>
                    <div class="funnel-label-bar funnel-segment-4" data-funnel-stage="4">
                      <span class="funnel-label-left">
                        <svg class="funnel-strip-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4 4l7.07 17 2.51-7.39L21 11.07z"/></svg>
                        <span>Clicked</span>
                      </span>
                      <span class="funnel-label-right">
                        <span id="funnel-value-4-copy" class="funnel-stage-value font-semibold">1.46M</span>
                        <span id="funnel-delta-4-copy" class="funnel-stage-delta negative">-4.4%</span>
                      </span>
                    </div>
                    <div class="funnel-label-bar funnel-segment-5" data-funnel-stage="5">
                      <span class="funnel-label-left">
                        <svg class="funnel-strip-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                        <span>Bounced</span>
                      </span>
                      <span class="funnel-label-right">
                        <span id="funnel-value-5-copy" class="funnel-stage-value font-semibold">360K</span>
                        <span id="funnel-delta-5-copy" class="funnel-stage-delta negative">-10.7%</span>
                      </span>
                    </div>
                  </div>
                </div>

                <!-- Key insight (inline) -->
                <div class="mt-8 pt-6 border-t border-neutral-100 hidden">
                  <div class="rounded-lg border border-purple-200 bg-purple-50 p-4">
                    <p class="text-sm font-semibold text-neutral-800 mb-0.5">AI Summary</p>
                    <p class="text-xs text-neutral-500 mb-3">Key drivers of your funnel performance this period</p>
                    <ul class="space-y-1.5 text-sm text-neutral-700 mb-4">
                      <li><span class="font-medium">🟢 Strong:</span> Send volume up (+5.2%), bounce rate improved</li>
                      <li><span class="font-medium">🔴 Attention:</span> Opens (-7.8%) and clicks (-4.4%) declined</li>
                      <li><span class="font-medium">🎯 Opportunity:</span> Optimize CTAs and segmentation to improve conversion</li>
                    </ul>
                    <label for="funnel-ask-input-copy" class="block text-sm font-medium text-neutral-700 mb-1">Ask the AI coach about your performance</label>
                    <div class="flex gap-2">
                      <input type="text" id="funnel-ask-input-copy" placeholder="Why did my engagement change?" class="flex-1 rounded-lg border border-neutral-200 px-3 py-2 text-sm focus:ring-2 focus:ring-main-500 focus:border-transparent" />
                      <button type="button" id="funnel-ask-btn-copy" class="rounded-lg bg-main-600 px-3 py-2 text-sm font-medium text-white hover:bg-main-700">Get recommendations</button>
                    </div>
                    <p class="text-xs text-neutral-400 mt-3 pt-3 border-t border-purple-200/60">Based on 8.99M sends and 8.63M deliveries in the selected period</p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Content Performance & Engagement by Device -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Content Performance -->
            <section class="funnel-card overflow-hidden bg-white">
              <div class="funnel-card-header border-b border-neutral-100 px-6 py-4">
                <h2 class="text-lg font-semibold text-neutral-900">Content performance</h2>
                <p class="mt-1 text-sm text-neutral-700">See which subject lines and campaigns drive the most engagement.</p>
              </div>
              <div class="p-6">
                <table class="w-full text-sm">
                  <thead>
                    <tr class="border-b border-neutral-100">
                      <th class="text-left py-2 pr-3 font-medium text-neutral-500 text-xs uppercase tracking-wider">Subject line</th>
                      <th class="text-right py-2 px-3 font-medium text-neutral-500 text-xs uppercase tracking-wider">Sends</th>
                      <th class="text-right py-2 px-3 font-medium text-neutral-500 text-xs uppercase tracking-wider">Open rate</th>
                      <th class="text-right py-2 pl-3 font-medium text-neutral-500 text-xs uppercase tracking-wider">Click rate</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="border-b border-neutral-50 hover:bg-neutral-50/50">
                      <td class="py-3 pr-3">
                        <p class="font-medium text-neutral-900 truncate max-w-[220px]">Your holiday shipping guide is here</p>
                        <p class="text-xs text-neutral-500 mt-0.5">Holiday Campaign · Dec 12</p>
                      </td>
                      <td class="text-right py-3 px-3 tabular-nums text-neutral-700">4,820</td>
                      <td class="text-right py-3 px-3">
                        <span class="tabular-nums font-medium text-neutral-900">72.4%</span>
                        <div class="w-full bg-neutral-100 rounded-full h-1.5 mt-1"><div class="bg-success-500 h-1.5 rounded-full" style="width:72.4%"></div></div>
                      </td>
                      <td class="text-right py-3 pl-3">
                        <span class="tabular-nums font-medium text-neutral-900">34.1%</span>
                      </td>
                    </tr>
                    <tr class="border-b border-neutral-50 hover:bg-neutral-50/50">
                      <td class="py-3 pr-3">
                        <p class="font-medium text-neutral-900 truncate max-w-[220px]">3 ways to save on overnight delivery</p>
                        <p class="text-xs text-neutral-500 mt-0.5">Promo Series · Dec 8</p>
                      </td>
                      <td class="text-right py-3 px-3 tabular-nums text-neutral-700">3,650</td>
                      <td class="text-right py-3 px-3">
                        <span class="tabular-nums font-medium text-neutral-900">68.2%</span>
                        <div class="w-full bg-neutral-100 rounded-full h-1.5 mt-1"><div class="bg-success-500 h-1.5 rounded-full" style="width:68.2%"></div></div>
                      </td>
                      <td class="text-right py-3 pl-3">
                        <span class="tabular-nums font-medium text-neutral-900">29.7%</span>
                      </td>
                    </tr>
                    <tr class="border-b border-neutral-50 hover:bg-neutral-50/50">
                      <td class="py-3 pr-3">
                        <p class="font-medium text-neutral-900 truncate max-w-[220px]">New year, new rates — see what changed</p>
                        <p class="text-xs text-neutral-500 mt-0.5">Announcement · Jan 2</p>
                      </td>
                      <td class="text-right py-3 px-3 tabular-nums text-neutral-700">5,120</td>
                      <td class="text-right py-3 px-3">
                        <span class="tabular-nums font-medium text-neutral-900">61.5%</span>
                        <div class="w-full bg-neutral-100 rounded-full h-1.5 mt-1"><div class="bg-success-500 h-1.5 rounded-full" style="width:61.5%"></div></div>
                      </td>
                      <td class="text-right py-3 pl-3">
                        <span class="tabular-nums font-medium text-neutral-900">22.3%</span>
                      </td>
                    </tr>
                    <tr class="border-b border-neutral-50 hover:bg-neutral-50/50">
                      <td class="py-3 pr-3">
                        <p class="font-medium text-neutral-900 truncate max-w-[220px]">Weekly digest: account activity summary</p>
                        <p class="text-xs text-neutral-500 mt-0.5">Automated · Weekly</p>
                      </td>
                      <td class="text-right py-3 px-3 tabular-nums text-neutral-700">8,940</td>
                      <td class="text-right py-3 px-3">
                        <span class="tabular-nums font-medium text-neutral-900">55.8%</span>
                        <div class="w-full bg-neutral-100 rounded-full h-1.5 mt-1"><div class="bg-warning-500 h-1.5 rounded-full" style="width:55.8%"></div></div>
                      </td>
                      <td class="text-right py-3 pl-3">
                        <span class="tabular-nums font-medium text-neutral-900">18.4%</span>
                      </td>
                    </tr>
                    <tr class="hover:bg-neutral-50/50">
                      <td class="py-3 pr-3">
                        <p class="font-medium text-neutral-900 truncate max-w-[220px]">Important: service area update</p>
                        <p class="text-xs text-neutral-500 mt-0.5">Transactional · Jan 5</p>
                      </td>
                      <td class="text-right py-3 px-3 tabular-nums text-neutral-700">2,310</td>
                      <td class="text-right py-3 px-3">
                        <span class="tabular-nums font-medium text-neutral-900">48.1%</span>
                        <div class="w-full bg-neutral-100 rounded-full h-1.5 mt-1"><div class="bg-danger-400 h-1.5 rounded-full" style="width:48.1%"></div></div>
                      </td>
                      <td class="text-right py-3 pl-3">
                        <span class="tabular-nums font-medium text-neutral-900">12.6%</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>

            <!-- Engagement by Device -->
            <section class="funnel-card overflow-hidden bg-white">
              <div class="funnel-card-header border-b border-neutral-100 px-6 py-4">
                <h2 class="text-lg font-semibold text-neutral-900">Engagement by device</h2>
                <p class="mt-1 text-sm text-neutral-700">How subscribers engage across desktop, mobile, and tablet.</p>
              </div>
              <div class="p-6">
                <div class="flex items-end justify-center gap-10 mb-8 pt-2">
                  <div class="flex flex-col items-center">
                    <div class="relative w-28 h-28">
                      <svg viewBox="0 0 36 36" class="w-28 h-28 -rotate-90">
                        <circle cx="18" cy="18" r="15.9" fill="none" stroke="#f0f4fa" stroke-width="3"/>
                        <circle cx="18" cy="18" r="15.9" fill="none" stroke="#186ded" stroke-width="3" stroke-dasharray="62 38" stroke-linecap="round"/>
                      </svg>
                      <div class="absolute inset-0 flex items-center justify-center">
                        <span class="text-xl font-bold text-neutral-900">62%</span>
                      </div>
                    </div>
                    <div class="mt-3 text-center">
                      <div class="flex items-center gap-1.5 justify-center">
                        <svg class="w-4 h-4 text-main-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>
                        <span class="text-sm font-semibold text-neutral-900">Mobile</span>
                      </div>
                      <p class="text-xs text-neutral-500 mt-0.5">68.4% open · 28.1% click</p>
                    </div>
                  </div>
                  <div class="flex flex-col items-center">
                    <div class="relative w-24 h-24">
                      <svg viewBox="0 0 36 36" class="w-24 h-24 -rotate-90">
                        <circle cx="18" cy="18" r="15.9" fill="none" stroke="#f0f4fa" stroke-width="3"/>
                        <circle cx="18" cy="18" r="15.9" fill="none" stroke="#079455" stroke-width="3" stroke-dasharray="30 70" stroke-linecap="round"/>
                      </svg>
                      <div class="absolute inset-0 flex items-center justify-center">
                        <span class="text-lg font-bold text-neutral-900">30%</span>
                      </div>
                    </div>
                    <div class="mt-3 text-center">
                      <div class="flex items-center gap-1.5 justify-center">
                        <svg class="w-4 h-4 text-success-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>
                        <span class="text-sm font-semibold text-neutral-900">Desktop</span>
                      </div>
                      <p class="text-xs text-neutral-500 mt-0.5">61.2% open · 31.5% click</p>
                    </div>
                  </div>
                  <div class="flex flex-col items-center">
                    <div class="relative w-20 h-20">
                      <svg viewBox="0 0 36 36" class="w-20 h-20 -rotate-90">
                        <circle cx="18" cy="18" r="15.9" fill="none" stroke="#f0f4fa" stroke-width="3"/>
                        <circle cx="18" cy="18" r="15.9" fill="none" stroke="#875bf7" stroke-width="3" stroke-dasharray="8 92" stroke-linecap="round"/>
                      </svg>
                      <div class="absolute inset-0 flex items-center justify-center">
                        <span class="text-base font-bold text-neutral-900">8%</span>
                      </div>
                    </div>
                    <div class="mt-3 text-center">
                      <div class="flex items-center gap-1.5 justify-center">
                        <svg class="w-4 h-4 text-accent-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"/><path d="M12 18h.01"/></svg>
                        <span class="text-sm font-semibold text-neutral-900">Tablet</span>
                      </div>
                      <p class="text-xs text-neutral-500 mt-0.5">58.9% open · 24.7% click</p>
                    </div>
                  </div>
                </div>
                <div class="border-t border-neutral-100 pt-4 space-y-3">
                  <div>
                    <div class="flex items-center justify-between mb-1">
                      <span class="text-sm text-neutral-700">Mobile</span>
                      <span class="text-sm font-medium text-neutral-900 tabular-nums">62%</span>
                    </div>
                    <div class="w-full bg-neutral-100 rounded-full h-2"><div class="bg-main-600 h-2 rounded-full transition-all" style="width:62%"></div></div>
                  </div>
                  <div>
                    <div class="flex items-center justify-between mb-1">
                      <span class="text-sm text-neutral-700">Desktop</span>
                      <span class="text-sm font-medium text-neutral-900 tabular-nums">30%</span>
                    </div>
                    <div class="w-full bg-neutral-100 rounded-full h-2"><div class="bg-success-700 h-2 rounded-full transition-all" style="width:30%"></div></div>
                  </div>
                  <div>
                    <div class="flex items-center justify-between mb-1">
                      <span class="text-sm text-neutral-700">Tablet</span>
                      <span class="text-sm font-medium text-neutral-900 tabular-nums">8%</span>
                    </div>
                    <div class="w-full bg-neutral-100 rounded-full h-2"><div class="bg-accent-600 h-2 rounded-full transition-all" style="width:8%"></div></div>
                  </div>
                </div>
              </div>
            </section>
          </div>

          <!-- Engagement Trend & Email Effectiveness (hidden) -->
          <style>
            .trend-eff-row { display: none; }
            .trend-bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; height: 100%; gap: 0; min-width: 0; }
            .trend-bar-col .trend-bar-rect { width: 100%; border-radius: 6px 6px 0 0; transition: height 0.5s cubic-bezier(0.22,1,0.36,1), background 0.3s; position: relative; z-index: 1; }
            .trend-bar-col:hover .trend-bar-rect { filter: brightness(1.08); }
            .trend-bar-col .trend-bar-value { font-size: 0.6875rem; font-weight: 600; letter-spacing: -0.01em; }
            .trend-bar-col .trend-bar-day { font-size: 0.6875rem; color: #6b7492; margin-top: 8px; }
            .trend-y-axis { display: flex; flex-direction: column; justify-content: space-between; align-items: flex-end; padding: 4px 0; width: 28px; flex-shrink: 0; }
            .trend-y-axis span { font-size: 0.625rem; color: #8d9bb6; line-height: 1; }
            .trend-grid-line { position: absolute; left: 0; right: 0; border-top: 1px dashed #dce2ec; z-index: 0; pointer-events: none; }
            .eff-chart-y { display: flex; flex-direction: column; justify-content: space-between; align-items: flex-end; width: 32px; flex-shrink: 0; padding: 2px 0; }
            .eff-chart-y span { font-size: 0.625rem; color: #8d9bb6; line-height: 1; }
          </style>
          <div class="trend-eff-row grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Engagement Trend (bar chart by day of week) -->
            <section class="funnel-card overflow-hidden bg-white" id="engagement-trend-widget">
              <div class="funnel-card-header border-b border-neutral-100 px-6 py-4">
                <div class="flex items-center justify-between">
                  <div>
                    <h2 class="text-lg font-semibold text-neutral-900">Engagement trend</h2>
                    <p class="mt-1 text-sm text-neutral-700">Performance by day of the week for the selected period.</p>
                  </div>
                  <div class="relative">
                    <button type="button" id="trend-metric-trigger" class="flex items-center gap-2 rounded-lg border border-neutral-200 bg-white px-3 py-1.5 text-sm font-medium text-neutral-700 hover:bg-neutral-50 transition-colors">
                      <span id="trend-metric-label">Open rate</span>
                      <svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                    </button>
                    <div id="trend-metric-dropdown" class="hidden absolute right-0 top-full mt-1 w-36 rounded-lg border border-neutral-200 bg-white py-1 shadow-lg z-50">
                      <button type="button" class="trend-metric-option w-full px-3 py-2 text-left text-sm hover:bg-neutral-50 font-medium text-main-600" data-metric="open">Open rate</button>
                      <button type="button" class="trend-metric-option w-full px-3 py-2 text-left text-sm hover:bg-neutral-50 text-neutral-700" data-metric="click">Click rate</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="px-6 pt-5 pb-6">
                <div class="flex gap-0 relative" style="height:230px;">
                  <div class="trend-y-axis">
                    <span>14%</span>
                    <span>10%</span>
                    <span>6%</span>
                    <span>2%</span>
                    <span>0%</span>
                  </div>
                  <div class="flex-1">
                    <div id="trend-bars-container" class="flex items-end h-full gap-3 relative">
                      <div class="trend-grid-line" style="top:0%"></div>
                      <div class="trend-grid-line" style="top:28.6%"></div>
                      <div class="trend-grid-line" style="top:57.1%"></div>
                      <div class="trend-grid-line" style="top:85.7%"></div>
                      <div class="trend-bar-col" data-day="Mon" data-open="4.2" data-click="1.8">
                        <span class="trend-bar-value text-neutral-600 mb-1.5">4.2%</span>
                        <div class="trend-bar-rect bg-main-300" style="height:30%"></div>
                        <span class="trend-bar-day">Mon</span>
                      </div>
                      <div class="trend-bar-col" data-day="Tue" data-open="11.3" data-click="5.1">
                        <span class="trend-bar-value text-neutral-700 mb-1.5">11.3%</span>
                        <div class="trend-bar-rect bg-main-400" style="height:80.7%"></div>
                        <span class="trend-bar-day">Tue</span>
                      </div>
                      <div class="trend-bar-col" data-day="Wed" data-open="12.1" data-click="5.8">
                        <span class="trend-bar-value text-main-700 mb-1.5">12.1%</span>
                        <div class="trend-bar-rect bg-main-500" style="height:86.4%"></div>
                        <span class="trend-bar-day font-semibold text-neutral-800">Wed</span>
                      </div>
                      <div class="trend-bar-col" data-day="Thu" data-open="8.7" data-click="4.2">
                        <span class="trend-bar-value text-neutral-700 mb-1.5">8.7%</span>
                        <div class="trend-bar-rect bg-main-400" style="height:62.1%"></div>
                        <span class="trend-bar-day">Thu</span>
                      </div>
                      <div class="trend-bar-col" data-day="Fri" data-open="6.9" data-click="3.4">
                        <span class="trend-bar-value text-neutral-600 mb-1.5">6.9%</span>
                        <div class="trend-bar-rect bg-main-300" style="height:49.3%"></div>
                        <span class="trend-bar-day">Fri</span>
                      </div>
                      <div class="trend-bar-col" data-day="Sat" data-open="2.1" data-click="0.9">
                        <span class="trend-bar-value text-neutral-500 mb-1.5">2.1%</span>
                        <div class="trend-bar-rect bg-main-200" style="height:15%"></div>
                        <span class="trend-bar-day">Sat</span>
                      </div>
                      <div class="trend-bar-col" data-day="Sun" data-open="1.8" data-click="0.7">
                        <span class="trend-bar-value text-neutral-500 mb-1.5">1.8%</span>
                        <div class="trend-bar-rect bg-main-200" style="height:12.9%"></div>
                        <span class="trend-bar-day">Sun</span>
                      </div>
                    </div>
                  </div>
                </div>
                <p class="text-xs text-neutral-400 text-center mt-3">Delivered at day of week</p>
              </div>
            </section>

            <!-- Email Effectiveness (line chart over months) -->
            <section class="funnel-card overflow-hidden bg-white">
              <div class="funnel-card-header border-b border-neutral-100 px-6 py-4">
                <h2 class="text-lg font-semibold text-neutral-900">Email effectiveness</h2>
                <p class="mt-1 text-sm text-neutral-700">Monthly trend of delivered, opened, and clicked emails.</p>
              </div>
              <div class="px-6 pt-5 pb-6">
                <div class="flex items-center justify-end gap-5 mb-4">
                  <div class="flex items-center gap-1.5"><span class="inline-block w-5 h-0.5 rounded bg-danger-500"></span><span class="text-xs text-neutral-600">Delivered</span></div>
                  <div class="flex items-center gap-1.5"><span class="inline-block w-5 h-0.5 rounded bg-success-600"></span><span class="text-xs text-neutral-600">Opened</span></div>
                  <div class="flex items-center gap-1.5"><span class="inline-block w-5 h-0.5 rounded bg-main-600"></span><span class="text-xs text-neutral-600">Unique clicks</span></div>
                </div>
                <div class="flex" style="height:210px;">
                  <div class="eff-chart-y">
                    <span>14</span>
                    <span>12</span>
                    <span>10</span>
                    <span>8</span>
                    <span>6</span>
                    <span>4</span>
                    <span>2</span>
                    <span>0</span>
                  </div>
                  <div class="flex-1 ml-2 relative">
                    <svg viewBox="0 0 500 210" class="w-full h-full" preserveAspectRatio="none">
                      <defs>
                        <linearGradient id="grad-del2" x1="0" y1="0" x2="0" y2="1">
                          <stop offset="0%" stop-color="#fda29b" stop-opacity="0.25"/>
                          <stop offset="100%" stop-color="#fda29b" stop-opacity="0.02"/>
                        </linearGradient>
                        <linearGradient id="grad-open2" x1="0" y1="0" x2="0" y2="1">
                          <stop offset="0%" stop-color="#75e0a7" stop-opacity="0.2"/>
                          <stop offset="100%" stop-color="#75e0a7" stop-opacity="0.02"/>
                        </linearGradient>
                      </defs>
                      <line x1="0" y1="30" x2="500" y2="30" stroke="#f0f4fa" stroke-width="0.7"/>
                      <line x1="0" y1="60" x2="500" y2="60" stroke="#f0f4fa" stroke-width="0.7"/>
                      <line x1="0" y1="90" x2="500" y2="90" stroke="#f0f4fa" stroke-width="0.7"/>
                      <line x1="0" y1="120" x2="500" y2="120" stroke="#f0f4fa" stroke-width="0.7"/>
                      <line x1="0" y1="150" x2="500" y2="150" stroke="#f0f4fa" stroke-width="0.7"/>
                      <line x1="0" y1="180" x2="500" y2="180" stroke="#f0f4fa" stroke-width="0.7"/>
                      <line x1="0" y1="210" x2="500" y2="210" stroke="#dce2ec" stroke-width="0.7"/>
                      <!-- Delivered: 0.5 → 1 → 11 → 7 → 13 → 10 → 2 -->
                      <path d="M0 203 L83 195 L167 45 L250 105 L333 15 L417 60 L500 180" fill="url(#grad-del2)" stroke="none"/>
                      <path d="M0 203 L83 195 L167 45 L250 105 L333 15 L417 60 L500 180" fill="none" stroke="#f04438" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                      <!-- Opened: 0.3 → 0.5 → 9 → 6 → 7 → 7 → 3 -->
                      <path d="M0 205 L83 203 L167 75 L250 120 L333 105 L417 105 L500 165" fill="url(#grad-open2)" stroke="none"/>
                      <path d="M0 205 L83 203 L167 75 L250 120 L333 105 L417 105 L500 165" fill="none" stroke="#17b26a" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                      <!-- Unique clicks: near zero flat -->
                      <path d="M0 208 L83 208 L167 200 L250 207 L333 205 L417 207 L500 208" fill="none" stroke="#186ded" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                      <!-- Data points — Delivered -->
                      <circle cx="0" cy="203" r="4" fill="#fff" stroke="#f04438" stroke-width="2"/>
                      <circle cx="83" cy="195" r="4" fill="#fff" stroke="#f04438" stroke-width="2"/>
                      <circle cx="167" cy="45" r="4" fill="#fff" stroke="#f04438" stroke-width="2"/>
                      <circle cx="250" cy="105" r="4" fill="#fff" stroke="#f04438" stroke-width="2"/>
                      <circle cx="333" cy="15" r="4" fill="#fff" stroke="#f04438" stroke-width="2"/>
                      <circle cx="417" cy="60" r="4" fill="#fff" stroke="#f04438" stroke-width="2"/>
                      <circle cx="500" cy="180" r="4" fill="#fff" stroke="#f04438" stroke-width="2"/>
                      <!-- Data points — Opened -->
                      <circle cx="0" cy="205" r="4" fill="#fff" stroke="#17b26a" stroke-width="2"/>
                      <circle cx="83" cy="203" r="4" fill="#fff" stroke="#17b26a" stroke-width="2"/>
                      <circle cx="167" cy="75" r="4" fill="#fff" stroke="#17b26a" stroke-width="2"/>
                      <circle cx="250" cy="120" r="4" fill="#fff" stroke="#17b26a" stroke-width="2"/>
                      <circle cx="333" cy="105" r="4" fill="#fff" stroke="#17b26a" stroke-width="2"/>
                      <circle cx="417" cy="105" r="4" fill="#fff" stroke="#17b26a" stroke-width="2"/>
                      <circle cx="500" cy="165" r="4" fill="#fff" stroke="#17b26a" stroke-width="2"/>
                      <!-- Data points — Clicks -->
                      <circle cx="0" cy="208" r="3.5" fill="#fff" stroke="#186ded" stroke-width="2"/>
                      <circle cx="83" cy="208" r="3.5" fill="#fff" stroke="#186ded" stroke-width="2"/>
                      <circle cx="167" cy="200" r="3.5" fill="#fff" stroke="#186ded" stroke-width="2"/>
                      <circle cx="250" cy="207" r="3.5" fill="#fff" stroke="#186ded" stroke-width="2"/>
                      <circle cx="333" cy="205" r="3.5" fill="#fff" stroke="#186ded" stroke-width="2"/>
                      <circle cx="417" cy="207" r="3.5" fill="#fff" stroke="#186ded" stroke-width="2"/>
                      <circle cx="500" cy="208" r="3.5" fill="#fff" stroke="#186ded" stroke-width="2"/>
                    </svg>
                  </div>
                </div>
                <div class="flex justify-between text-xs text-neutral-500 mt-2" style="margin-left:40px;">
                  <span>Dec</span><span>Jan</span><span>Feb</span><span>Mar</span><span>Apr</span><span>May</span><span>Jun</span>
                </div>
              </div>
            </section>
          </div>

          <!-- Insights Panel (full-height right panel) -->
          <div id="ai-insights-panel-backdrop" class="fixed inset-0 bg-black/20 z-[100] hidden" aria-hidden="true" onclick="document.getElementById('ai-panel-close') && document.getElementById('ai-panel-close').click();"></div>
          <div id="ai-insights-panel" class="fixed top-0 bottom-0 z-[101] hidden w-full border-l border-neutral-200 bg-white flex flex-col">
            <header class="ai-chat-panel-header flex-shrink-0">
              <div class="ai-chat-panel-header-left">
                <div class="ai-chat-header-avatar" aria-hidden="true">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                </div>
                <div class="ai-chat-header-text">
                  <h3 class="ai-chat-header-title">Insights chat</h3>
                  <p class="ai-chat-header-tagline">Get report insights and recommended actions.</p>
                </div>
              </div>
              <div class="ai-chat-header-controls">
                <button type="button" id="ai-panel-minimize" class="ai-chat-header-minimize" aria-label="Minimize to tray">−</button>
                <button type="button" id="ai-panel-close" class="ai-chat-header-minimize" aria-label="Close">×</button>
              </div>
            </header>
            <div id="ai-chat-conversation" class="pt-4 px-4 pb-0 overflow-y-auto flex-1 min-h-0 bg-neutral-50/50">
              <div id="ai-chat-welcome" class="space-y-6">
                <div class="ai-chat-greeting-wrap" id="ai-greeting-wrap">
                  <p class="ai-chat-greeting-text">Hi Gail — here's a quick summary of your email performance for the selected period.</p>
                </div>

                <section class="ai-chat-welcome-section ai-reveal-step" data-reveal-order="1" id="ai-insights-section">
                  <div class="ai-chat-summary-card" id="ai-insights-card">
                    <div class="ai-insights-skeleton" id="ai-insights-skeleton" aria-hidden="true">
                      <div class="ai-insights-skeleton-line short"></div>
                      <div class="ai-insights-skeleton-line long"></div>
                      <div class="ai-insights-skeleton-line medium"></div>
                      <div class="ai-insights-skeleton-line long"></div>
                      <div class="ai-insights-skeleton-line medium"></div>
                    </div>
                    <div class="ai-chat-summary-card-content">
                    <p class="ai-chat-action-label"><svg class="ai-chat-key-insights-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg> Key insights</p>
                    <div class="ai-chat-metrics">
                      <span class="metric-line">Open rate: <strong>65.0%</strong> (<span class="metric-down">↓ 7.8%</span> vs last period)</span>
                      <span class="metric-line">Click-through rate: <strong>26.2%</strong> (<span class="metric-down">↓ 4.4%</span>)</span>
                      <span class="metric-line">Delivery: <strong>99.4%</strong> — strong and stable</span>
                      <span class="metric-line">Volume: <strong>8.63M</strong> delivered (<span class="metric-up">+5.2%</span>) indicating healthy list</span>
                    </div>
                    <p class="ai-chat-action-label">What to focus on next</p>
                    <ul>
                      <li>Test subject lines and send times (A/B test)</li>
                      <li>Improve CTAs in underperforming campaigns</li>
                      <li>Review UPS Midwest and low-open segments</li>
                      <li>Replicate strategies from top performer (UPS Northeast)</li>
                    </ul>
                    </div>
                  </div>
                </section>

                <section class="ai-chat-welcome-section ai-reveal-step" data-reveal-order="2">
                  <p class="ai-chat-section-label">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 21h18"/><path d="M3 10h18"/><path d="M5 6l7-3 7 3"/><path d="M4 10v11"/><path d="M20 10v11"/><path d="M8 14v3"/><path d="M12 14v3"/><path d="M16 14v3"/></svg>
                    Accounts spotlight
                  </p>
                  <div class="grid grid-cols-2 gap-2">
                    <button type="button" class="ai-view-account ai-chat-quick-link-card w-full flex items-center justify-between text-left min-w-0" data-account="UPS Northeast">
                      <div class="min-w-0 truncate">
                        <p class="ai-chat-quick-badge">Top performer</p>
                        <span class="text-sm font-medium text-neutral-900 truncate block">UPS Northeast</span>
                      </div>
                      <svg class="w-4 h-4 text-neutral-400 flex-shrink-0 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                    </button>
                    <button type="button" class="ai-view-account ai-chat-quick-link-card needs-attention w-full flex items-center justify-between text-left min-w-0" data-account="UPS Midwest">
                      <div class="min-w-0 truncate">
                        <p class="ai-chat-quick-badge">Needs attention</p>
                        <span class="text-sm font-medium text-neutral-900 truncate block">UPS Midwest</span>
                      </div>
                      <svg class="w-4 h-4 text-neutral-400 flex-shrink-0 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                    </button>
                  </div>
                </section>

                <section class="ai-chat-welcome-section ai-reveal-step" data-reveal-order="3">
                  <p class="ai-chat-section-label">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                    Here's what I can help with:
                  </p>
                <div class="flex flex-nowrap gap-2 overflow-x-auto min-w-0">
                  <button type="button" class="ai-suggested-prompt ai-chat-suggestion-pill" data-prompt="Can you identify which accounts are under performing?">Find underperforming accounts</button>
                  <button type="button" class="ai-suggested-prompt ai-chat-suggestion-pill" data-prompt="How is the overall email engagement looking like for the last 7 days">View last 7-day engagement</button>
                  <button type="button" class="ai-suggested-prompt ai-chat-suggestion-pill" data-prompt="Give me insights on Northwest Branch">Analyze an account or branch</button>
                  </div>
                </section>
              </div>
              <div id="ai-chat-messages" class="space-y-5 hidden"></div>
              <div id="ai-chat-typing" class="hidden flex items-center gap-1.5 py-2">
                <span class="ai-typing-dot w-2 h-2 rounded-full bg-neutral-400 animate-pulse"></span>
                <span class="ai-typing-dot w-2 h-2 rounded-full bg-neutral-400 animate-pulse" style="animation-delay: 0.2s"></span>
                <span class="ai-typing-dot w-2 h-2 rounded-full bg-neutral-400 animate-pulse" style="animation-delay: 0.4s"></span>
              </div>
            </div>
            <div class="pt-1.5 px-4 pb-4 border-t border-neutral-100 flex-shrink-0 bg-white">
              <div class="ai-chat-input-wrap">
                <input type="text" id="ai-ask-input" placeholder="Ask why the metric changed, what to improve or which accounts need attention" aria-label="Ask for insights and recommendations" />
                <button type="button" id="ai-ask-submit" class="ai-chat-send-btn" aria-label="Send">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                </button>
              </div>
            </div>
          </div>
          <script>
            (function(){
              window.openAiInsightsPanel = function() {
                var p = document.getElementById('ai-insights-panel');
                var b = document.getElementById('ai-insights-panel-backdrop');
                if (p) { p.classList.remove('hidden'); p.classList.add('ai-panel-visible'); }
                if (b) { b.classList.remove('hidden'); b.classList.add('ai-panel-visible'); }
                document.documentElement.classList.add('ai-panel-open');
                var bodyEl = document.getElementById('body-el') || document.body;
                if (bodyEl) bodyEl.classList.add('scroll-lock');
              };
            })();
          </script>
          <button type="button" id="ai-insights-float-btn" aria-label="Open Insights chat">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          </button>

          <!-- Engagement by account -->
          <section id="engagement-by-account-section" class="mb-8">
            <div class="funnel-card overflow-hidden">
              <div class="funnel-card-header border-b border-neutral-100 px-6 py-4">
                <div class="flex items-start justify-between gap-4">
                  <div>
                    <h2 class="text-lg font-semibold text-neutral-900">Engagement by account</h2>
                    <p class="mt-1 text-sm text-neutral-700">Compare sub-account engagement to spot top performers, accounts needing attention, and trends in opens, clicks, and opt-outs.</p>
                  </div>
                  <div class="flex items-center gap-2 flex-shrink-0 relative">
                    <button type="button" id="accounts-table-columns-trigger" class="p-2 rounded-lg text-neutral-400 hover:bg-neutral-100 hover:text-neutral-600 transition-colors" aria-label="Column visibility" aria-haspopup="true" aria-expanded="false">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    </button>
                    <div id="accounts-table-columns-dropdown" class="hidden absolute right-0 top-full mt-1 w-56 rounded-lg border border-neutral-200 bg-white py-2 shadow-lg z-50" role="menu">
                      <p class="px-3 py-1.5 text-xs font-semibold text-neutral-500 uppercase tracking-wide">Show columns</p>
                      <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer"><input type="checkbox" class="accounts-column-toggle rounded border-neutral-300" data-col="3" checked> <span class="text-sm text-neutral-800">Campaigns</span></label>
                      <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer"><input type="checkbox" class="accounts-column-toggle rounded border-neutral-300" data-col="4" checked> <span class="text-sm text-neutral-800">Sends</span></label>
                      <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer"><input type="checkbox" class="accounts-column-toggle rounded border-neutral-300" data-col="5" checked> <span class="text-sm text-neutral-800">Open rate</span></label>
                      <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer"><input type="checkbox" class="accounts-column-toggle rounded border-neutral-300" data-col="6" checked> <span class="text-sm text-neutral-800">Click rate</span></label>
                      <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer"><input type="checkbox" class="accounts-column-toggle rounded border-neutral-300" data-col="7" checked> <span class="text-sm text-neutral-800">Opt-out rate</span></label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="p-6">
              <div id="accounts-filters-row" class="flex flex-wrap gap-2 mb-4">
                <button type="button" class="accounts-pill px-3 py-1.5 text-sm font-medium rounded-full bg-main-100 text-main-800" data-filter="all">All</button>
                <button type="button" class="accounts-pill px-3 py-1.5 text-sm font-medium rounded-full bg-neutral-100 text-neutral-600 hover:bg-neutral-200" data-filter="high">High performing</button>
                <button type="button" class="accounts-pill px-3 py-1.5 text-sm font-medium rounded-full bg-neutral-100 text-neutral-600 hover:bg-neutral-200" data-filter="low">Low performing</button>
                <button type="button" class="accounts-pill px-3 py-1.5 text-sm font-medium rounded-full bg-neutral-100 text-neutral-600 hover:bg-neutral-200" data-filter="attention">Needs attention</button>
              </div>
              <div id="accounts-compare-bar" class="hidden mb-4 flex items-center gap-3">
                <span class="text-sm font-medium text-neutral-700"><span id="accounts-selected-count">0</span> selected</span>
                <button type="button" id="accounts-compare-btn" class="inline-flex items-center justify-center px-4 py-2 text-sm font-semibold text-main-700 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-50 transition-colors shadow-sm">Compare accounts</button>
              </div>
              <div class="overflow-x-auto">
                <table class="w-full min-w-[800px]" id="accounts-table">
                  <thead>
                    <tr class="bg-neutral-50 border-b border-neutral-100">
                      <th class="text-left py-3 pl-6 pr-2 w-10"><input type="checkbox" id="accounts-select-all" class="rounded border-neutral-300" aria-label="Select all"></th>
                      <th class="text-left py-3 px-3 text-sm font-semibold text-neutral-800">Account</th>
                      <th class="text-right py-3 px-3 text-sm font-semibold text-neutral-800">
                        <span class="inline-flex items-center gap-1">Campaigns<svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/></svg></span>
                      </th>
                      <th class="text-right py-3 px-3 text-sm font-semibold text-neutral-800">
                        <span class="inline-flex items-center gap-1">Sends<svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/></svg></span>
                      </th>
                      <th class="text-right py-3 px-3 text-sm font-semibold text-neutral-800">
                        <span class="inline-flex items-center gap-1">Open rate<svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/></svg></span>
                      </th>
                      <th class="text-right py-3 px-3 text-sm font-semibold text-neutral-800">
                        <span class="inline-flex items-center gap-1">Click rate<svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/></svg></span>
                      </th>
                      <th class="text-right py-3 pr-6 pl-3 text-sm font-semibold text-neutral-800">
                        <span class="inline-flex items-center gap-1">Opt-out rate<svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/></svg></span>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="accounts-row accounts-parent-row border-b border-neutral-100 bg-white hover:bg-neutral-50/50 transition-colors" data-account="UPS Northeast" data-tier="high">
                      <td class="py-4 pl-6 pr-2 sticky-col"><input type="checkbox" class="account-row-check rounded border-neutral-300"></td>
                      <td class="py-4 px-3 text-sm font-medium text-neutral-900">
                        <button type="button" class="accounts-expand-btn inline-flex items-center justify-center w-6 h-6 rounded hover:bg-neutral-100 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand sub-accounts" data-expand-for="UPS Northeast">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                        </button>
                        UPS Northeast
                      </td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">320</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">2,840,000</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">72.1%</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">31.2%</a></td>
                      <td class="py-4 pr-6 pl-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">0.4%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Northeast">
                      <td class="py-2 pl-6 pr-2 sticky-col w-10"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Boston</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">98</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">820,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">73.2%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">32.1%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.3%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Northeast">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">New York</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">142</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">1,240,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">71.8%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">30.5%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.4%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Northeast">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Philadelphia</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">80</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">780,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">71.2%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">31.0%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.5%</a></td>
                    </tr>
                    <tr class="accounts-row accounts-parent-row border-b border-neutral-100 bg-neutral-50/30 hover:bg-neutral-50/50 transition-colors" data-account="UPS Southeast" data-tier="high">
                      <td class="py-4 pl-6 pr-2 sticky-col"><input type="checkbox" class="account-row-check rounded border-neutral-300"></td>
                      <td class="py-4 px-3 text-sm font-medium text-neutral-900">
                        <button type="button" class="accounts-expand-btn inline-flex items-center justify-center w-6 h-6 rounded hover:bg-neutral-100 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand sub-accounts" data-expand-for="UPS Southeast">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                        </button>
                        UPS Southeast
                      </td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">280</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">2,100,000</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">68.5%</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">28.0%</a></td>
                      <td class="py-4 pr-6 pl-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">0.5%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Southeast">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Atlanta</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">95</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">780,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">69.1%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">27.8%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.5%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Southeast">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Miami</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">88</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">720,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">68.0%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">28.2%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.6%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Southeast">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Charlotte</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">97</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">600,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">68.4%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">27.9%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.4%</a></td>
                    </tr>
                    <tr class="accounts-row accounts-parent-row border-b border-neutral-100 bg-white hover:bg-neutral-50/50 transition-colors" data-account="UPS Midwest" data-tier="attention">
                      <td class="py-4 pl-6 pr-2 sticky-col"><input type="checkbox" class="account-row-check rounded border-neutral-300"></td>
                      <td class="py-4 px-3 text-sm font-medium text-neutral-900">
                        <button type="button" class="accounts-expand-btn inline-flex items-center justify-center w-6 h-6 rounded hover:bg-neutral-100 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand sub-accounts" data-expand-for="UPS Midwest">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                        </button>
                        UPS Midwest
                      </td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">180</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">1,240,000</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">48.2%</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">18.1%</a></td>
                      <td class="py-4 pr-6 pl-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">1.2%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Midwest">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Chicago</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">72</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">520,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">49.0%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">18.5%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">1.1%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Midwest">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Detroit</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">58</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">380,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">47.8%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">17.6%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">1.3%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Midwest">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Minneapolis</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">50</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">340,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">47.8%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">18.2%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">1.2%</a></td>
                    </tr>
                    <tr class="accounts-row accounts-parent-row border-b border-neutral-100 bg-neutral-50/30 hover:bg-neutral-50/50 transition-colors" data-account="UPS Southwest" data-tier="low">
                      <td class="py-4 pl-6 pr-2 sticky-col"><input type="checkbox" class="account-row-check rounded border-neutral-300"></td>
                      <td class="py-4 px-3 text-sm font-medium text-neutral-900">
                        <button type="button" class="accounts-expand-btn inline-flex items-center justify-center w-6 h-6 rounded hover:bg-neutral-100 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand sub-accounts" data-expand-for="UPS Southwest">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                        </button>
                        UPS Southwest
                      </td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">120</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">890,000</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">52.0%</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">19.5%</a></td>
                      <td class="py-4 pr-6 pl-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">0.8%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Southwest">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Dallas</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">48</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">380,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">52.5%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">19.8%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.7%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Southwest">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Houston</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">42</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">310,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">51.2%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">19.2%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.9%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS Southwest">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Phoenix</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">30</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">200,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">52.4%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">19.4%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.8%</a></td>
                    </tr>
                    <tr class="accounts-row accounts-parent-row border-b border-neutral-100 bg-white hover:bg-neutral-50/50 transition-colors" data-account="UPS West" data-tier="high">
                      <td class="py-4 pl-6 pr-2 sticky-col"><input type="checkbox" class="account-row-check rounded border-neutral-300"></td>
                      <td class="py-4 px-3 text-sm font-medium text-neutral-900">
                        <button type="button" class="accounts-expand-btn inline-flex items-center justify-center w-6 h-6 rounded hover:bg-neutral-100 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand sub-accounts" data-expand-for="UPS West">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                        </button>
                        UPS West
                      </td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">260</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">1,920,000</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">65.8%</a></td>
                      <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">26.4%</a></td>
                      <td class="py-4 pr-6 pl-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">0.3%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS West">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Los Angeles</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">112</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">920,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">66.2%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.8%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.3%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS West">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">Seattle</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">78</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">520,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">65.0%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">25.9%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.4%</a></td>
                    </tr>
                    <tr class="accounts-child-row hidden" data-parent="UPS West">
                      <td class="py-2 pl-6 pr-2 sticky-col"></td>
                      <td class="py-2 pl-10 px-3 text-xs text-neutral-700">San Francisco</td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">70</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">480,000</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">66.2%</a></td>
                      <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.5%</a></td>
                      <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.3%</a></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              </div>
            </div>
          </section>

          <!-- Engagement by campaign -->
          <section class="mb-8">
            <div class="funnel-card overflow-hidden">
              <div class="funnel-card-header border-b border-neutral-100 px-6 py-4">
                <div class="flex items-start justify-between gap-4">
                  <div>
                    <h2 class="text-lg font-semibold text-neutral-900">Engagement by campaign</h2>
                    <p class="mt-1 text-sm text-neutral-700">Email campaign performance for the selected date range.</p>
                  </div>
                  <div class="flex items-center gap-2 flex-shrink-0 relative">
                    <button type="button" id="campaigns-table-columns-trigger" class="p-2 rounded-lg text-neutral-400 hover:bg-neutral-100 hover:text-neutral-600 transition-colors" aria-label="Column visibility" aria-haspopup="true" aria-expanded="false">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    </button>
                    <div id="campaigns-table-columns-dropdown" class="hidden absolute right-0 top-full mt-1 w-56 rounded-lg border border-neutral-200 bg-white py-2 shadow-lg z-50" role="menu">
                      <p class="px-3 py-1.5 text-xs font-semibold text-neutral-500 uppercase tracking-wide">Show columns</p>
                      <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer"><input type="checkbox" class="campaigns-column-toggle rounded border-neutral-300" data-col="3" checked> <span class="text-sm text-neutral-800">Sends</span></label>
                      <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer"><input type="checkbox" class="campaigns-column-toggle rounded border-neutral-300" data-col="4" checked> <span class="text-sm text-neutral-800">Open rate</span></label>
                      <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer"><input type="checkbox" class="campaigns-column-toggle rounded border-neutral-300" data-col="5" checked> <span class="text-sm text-neutral-800">Click rate</span></label>
                      <label class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 cursor-pointer"><input type="checkbox" class="campaigns-column-toggle rounded border-neutral-300" data-col="6" checked> <span class="text-sm text-neutral-800">Opt-out rate</span></label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="p-6">
                <div id="campaigns-filters-row" class="flex flex-wrap gap-2 mb-4">
                  <button type="button" class="campaigns-pill px-3 py-1.5 text-sm font-medium rounded-full bg-main-100 text-main-800" data-filter="all">All</button>
                  <button type="button" class="campaigns-pill px-3 py-1.5 text-sm font-medium rounded-full bg-neutral-100 text-neutral-600 hover:bg-neutral-200" data-filter="high">High performing</button>
                  <button type="button" class="campaigns-pill px-3 py-1.5 text-sm font-medium rounded-full bg-neutral-100 text-neutral-600 hover:bg-neutral-200" data-filter="low">Low performing</button>
                </div>
                <div id="campaigns-compare-bar" class="hidden mb-4 flex items-center gap-3">
                  <span class="text-sm font-medium text-neutral-700"><span id="campaigns-selected-count">0</span> selected</span>
                  <button type="button" id="campaigns-compare-btn" class="inline-flex items-center justify-center px-4 py-2 text-sm font-semibold text-main-700 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-50 transition-colors shadow-sm">Compare campaigns</button>
                </div>
                <div class="overflow-x-auto">
                  <table class="w-full min-w-[800px]" id="campaigns-table">
                    <thead>
                      <tr class="bg-neutral-50 border-b border-neutral-100">
                        <th class="text-left py-3 pl-6 pr-2 w-10"><input type="checkbox" id="campaigns-select-all" class="rounded border-neutral-300" aria-label="Select all campaigns"></th>
                        <th class="text-left py-3 pl-2 pr-2 text-sm font-semibold text-neutral-800">Campaign</th>
                        <th class="text-right py-3 px-3 text-sm font-semibold text-neutral-800">
                          <span class="inline-flex items-center gap-1">Sends<svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/></svg></span>
                        </th>
                        <th class="text-right py-3 px-3 text-sm font-semibold text-neutral-800">
                          <span class="inline-flex items-center gap-1">Open rate<svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/></svg></span>
                        </th>
                        <th class="text-right py-3 px-3 text-sm font-semibold text-neutral-800">
                          <span class="inline-flex items-center gap-1">Click rate<svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/></svg></span>
                        </th>
                        <th class="text-right py-3 pr-6 pl-3 text-sm font-semibold text-neutral-800">
                          <span class="inline-flex items-center gap-1">Opt-out rate<svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/></svg></span>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="campaigns-row campaigns-parent-row border-b border-neutral-100 bg-white hover:bg-neutral-50/50 transition-colors" data-tier="high" data-campaign="q1-newsletter" data-campaign-type="central">
                        <td class="py-4 pl-6 pr-2 sticky-col w-10"><input type="checkbox" class="campaign-row-check rounded border-neutral-300"></td>
                        <td class="py-4 pl-2 pr-2 text-sm font-medium text-neutral-900 sticky-col">
                          <button type="button" class="campaigns-expand-btn inline-flex items-center justify-center w-6 h-6 rounded hover:bg-neutral-100 text-neutral-500 hover:text-neutral-700 mr-2 align-middle shrink-0" aria-label="Expand accounts" data-expand-for="q1-newsletter">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          <span class="inline-block align-top">
                            <span class="block">Q1 Newsletter — Brand Update</span>
                            <span class="block mt-0.5 text-xs font-normal text-neutral-500">Central send</span>
                          </span>
                        </td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">284,000</a></td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">66.6%</a></td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">26.6%</a></td>
                        <td class="py-4 pr-6 pl-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-child-row hidden" data-parent="q1-newsletter" data-expand-id="q1-newsletter-ups-northeast" data-account="UPS Northeast">
                        <td class="py-2 pl-6 pr-2 sticky-col w-10"></td>
                        <td class="py-2 pl-10 px-3 text-xs text-neutral-700">
                          <button type="button" class="campaigns-account-expand-btn inline-flex items-center justify-center w-5 h-5 rounded hover:bg-neutral-200 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand locations" data-expand-for="q1-newsletter-ups-northeast">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          UPS Northeast
                        </td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">98,200</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">67.1%</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">27.0%</a></td>
                        <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="q1-newsletter-ups-northeast">
                        <td class="py-1.5 pl-6 pr-2 sticky-col w-10"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Boston</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">42,100</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">67.5%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">27.2%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="q1-newsletter-ups-northeast">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">New York</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">56,100</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">66.8%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.9%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-child-row hidden" data-parent="q1-newsletter" data-expand-id="q1-newsletter-ups-west" data-account="UPS West">
                        <td class="py-2 pl-6 pr-2 sticky-col"></td>
                        <td class="py-2 pl-10 px-3 text-xs text-neutral-700">
                          <button type="button" class="campaigns-account-expand-btn inline-flex items-center justify-center w-5 h-5 rounded hover:bg-neutral-200 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand locations" data-expand-for="q1-newsletter-ups-west">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          UPS West
                        </td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">185,800</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">66.2%</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.3%</a></td>
                        <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="q1-newsletter-ups-west">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Los Angeles</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">92,400</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">66.4%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.2%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="q1-newsletter-ups-west">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Seattle</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">93,400</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">66.0%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.4%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-row campaigns-parent-row border-b border-neutral-100 bg-neutral-50/30 hover:bg-neutral-50/50 transition-colors" data-tier="high" data-campaign="holiday-promo" data-campaign-type="central">
                        <td class="py-4 pl-6 pr-2 sticky-col"><input type="checkbox" class="campaign-row-check rounded border-neutral-300"></td>
                        <td class="py-4 pl-2 pr-2 text-sm font-medium text-neutral-900 sticky-col">
                          <button type="button" class="campaigns-expand-btn inline-flex items-center justify-center w-6 h-6 rounded hover:bg-neutral-100 text-neutral-500 hover:text-neutral-700 mr-2 align-middle shrink-0" aria-label="Expand accounts" data-expand-for="holiday-promo">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          <span class="inline-block align-top">
                            <span class="block">Holiday Promo — Free Shipping</span>
                            <span class="block mt-0.5 text-xs font-normal text-neutral-500">Central send</span>
                          </span>
                        </td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">412,000</a></td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">64.4%</a></td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">26.4%</a></td>
                        <td class="py-4 pr-6 pl-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">0.3%</a></td>
                      </tr>
                      <tr class="campaigns-child-row hidden" data-parent="holiday-promo" data-expand-id="holiday-promo-ups-southeast" data-account="UPS Southeast">
                        <td class="py-2 pl-6 pr-2 sticky-col"></td>
                        <td class="py-2 pl-10 px-3 text-xs text-neutral-700">
                          <button type="button" class="campaigns-account-expand-btn inline-flex items-center justify-center w-5 h-5 rounded hover:bg-neutral-200 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand locations" data-expand-for="holiday-promo-ups-southeast">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          UPS Southeast
                        </td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">165,000</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">64.8%</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.2%</a></td>
                        <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.3%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="holiday-promo-ups-southeast">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Atlanta</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">82,500</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">65.0%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.0%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.3%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="holiday-promo-ups-southeast">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Miami</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">82,500</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">64.6%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.4%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.3%</a></td>
                      </tr>
                      <tr class="campaigns-child-row hidden" data-parent="holiday-promo" data-expand-id="holiday-promo-ups-northeast" data-account="UPS Northeast">
                        <td class="py-2 pl-6 pr-2 sticky-col"></td>
                        <td class="py-2 pl-10 px-3 text-xs text-neutral-700">
                          <button type="button" class="campaigns-account-expand-btn inline-flex items-center justify-center w-5 h-5 rounded hover:bg-neutral-200 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand locations" data-expand-for="holiday-promo-ups-northeast">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          UPS Northeast
                        </td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">247,000</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">64.0%</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.6%</a></td>
                        <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.3%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="holiday-promo-ups-northeast">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Boston</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">123,500</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">64.2%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.7%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.3%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="holiday-promo-ups-northeast">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">New York</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">123,500</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">63.8%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.5%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.3%</a></td>
                      </tr>
                      <tr class="campaigns-row campaigns-parent-row border-b border-neutral-100 bg-white hover:bg-neutral-50/50 transition-colors" data-tier="high" data-campaign="year-in-review" data-campaign-type="franchise">
                        <td class="py-4 pl-6 pr-2 sticky-col"><input type="checkbox" class="campaign-row-check rounded border-neutral-300"></td>
                        <td class="py-4 pl-2 pr-2 text-sm font-medium text-neutral-900 sticky-col">
                          <button type="button" class="campaigns-expand-btn inline-flex items-center justify-center w-6 h-6 rounded hover:bg-neutral-100 text-neutral-500 hover:text-neutral-700 mr-2 align-middle shrink-0" aria-label="Expand accounts" data-expand-for="year-in-review">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          <span class="inline-block align-top">
                            <span class="block">Year in Review — 2025 Highlights</span>
                            <span class="block mt-0.5 text-xs font-normal text-neutral-500">Franchise sent</span>
                          </span>
                        </td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">356,000</a></td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">64.6%</a></td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">26.0%</a></td>
                        <td class="py-4 pr-6 pl-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-child-row hidden" data-parent="year-in-review" data-expand-id="year-in-review-ups-midwest" data-account="UPS Midwest">
                        <td class="py-2 pl-6 pr-2 sticky-col"></td>
                        <td class="py-2 pl-10 px-3 text-xs text-neutral-700">
                          <button type="button" class="campaigns-account-expand-btn inline-flex items-center justify-center w-5 h-5 rounded hover:bg-neutral-200 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand locations" data-expand-for="year-in-review-ups-midwest">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          UPS Midwest
                        </td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">142,000</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">64.2%</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">25.8%</a></td>
                        <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="year-in-review-ups-midwest">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Chicago</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">71,000</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">64.4%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">25.7%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="year-in-review-ups-midwest">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Detroit</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">71,000</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">64.0%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">25.9%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-child-row hidden" data-parent="year-in-review" data-expand-id="year-in-review-ups-southwest" data-account="UPS Southwest">
                        <td class="py-2 pl-6 pr-2 sticky-col"></td>
                        <td class="py-2 pl-10 px-3 text-xs text-neutral-700">
                          <button type="button" class="campaigns-account-expand-btn inline-flex items-center justify-center w-5 h-5 rounded hover:bg-neutral-200 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand locations" data-expand-for="year-in-review-ups-southwest">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          UPS Southwest
                        </td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">214,000</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">64.8%</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.1%</a></td>
                        <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="year-in-review-ups-southwest">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Dallas</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">107,000</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">64.6%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.0%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="year-in-review-ups-southwest">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Houston</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">107,000</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">65.0%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">26.2%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.2%</a></td>
                      </tr>
                      <tr class="campaigns-row campaigns-parent-row border-b border-neutral-100 bg-neutral-50/30 hover:bg-neutral-50/50 transition-colors" data-tier="low" data-campaign="december-digest" data-campaign-type="franchise">
                        <td class="py-4 pl-6 pr-2 sticky-col"><input type="checkbox" class="campaign-row-check rounded border-neutral-300"></td>
                        <td class="py-4 pl-2 pr-2 text-sm font-medium text-neutral-900 sticky-col">
                          <button type="button" class="campaigns-expand-btn inline-flex items-center justify-center w-6 h-6 rounded hover:bg-neutral-100 text-neutral-500 hover:text-neutral-700 mr-2 align-middle shrink-0" aria-label="Expand accounts" data-expand-for="december-digest">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          <span class="inline-block align-top">
                            <span class="block">December Digest — Tips & Resources</span>
                            <span class="block mt-0.5 text-xs font-normal text-neutral-500">Franchise sent</span>
                          </span>
                        </td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">248,000</a></td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">64.1%</a></td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">25.0%</a></td>
                        <td class="py-4 pr-6 pl-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">0.5%</a></td>
                      </tr>
                      <tr class="campaigns-child-row hidden" data-parent="december-digest" data-expand-id="december-digest-ups-west" data-account="UPS West">
                        <td class="py-2 pl-6 pr-2 sticky-col"></td>
                        <td class="py-2 pl-10 px-3 text-xs text-neutral-700">
                          <button type="button" class="campaigns-account-expand-btn inline-flex items-center justify-center w-5 h-5 rounded hover:bg-neutral-200 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand locations" data-expand-for="december-digest-ups-west">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          UPS West
                        </td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">248,000</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">64.1%</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">25.0%</a></td>
                        <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.5%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="december-digest-ups-west">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">San Francisco</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">248,000</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">64.1%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">25.0%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.5%</a></td>
                      </tr>
                      <tr class="campaigns-row campaigns-parent-row border-b border-neutral-100 bg-white hover:bg-neutral-50/50 transition-colors" data-tier="low" data-campaign="black-friday" data-campaign-type="franchise">
                        <td class="py-4 pl-6 pr-2 sticky-col"><input type="checkbox" class="campaign-row-check rounded border-neutral-300"></td>
                        <td class="py-4 pl-2 pr-2 text-sm font-medium text-neutral-900 sticky-col">
                          <button type="button" class="campaigns-expand-btn inline-flex items-center justify-center w-6 h-6 rounded hover:bg-neutral-100 text-neutral-500 hover:text-neutral-700 mr-2 align-middle shrink-0" aria-label="Expand accounts" data-expand-for="black-friday">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          <span class="inline-block align-top">
                            <span class="block">Black Friday — Early Access</span>
                            <span class="block mt-0.5 text-xs font-normal text-neutral-500">Franchise sent</span>
                          </span>
                        </td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">520,000</a></td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">58.2%</a></td>
                        <td class="py-4 px-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">22.1%</a></td>
                        <td class="py-4 pr-6 pl-3 text-right text-sm"><a href="#" class="text-main-600 hover:underline">0.6%</a></td>
                      </tr>
                      <tr class="campaigns-child-row hidden" data-parent="black-friday" data-expand-id="black-friday-ups-northeast" data-account="UPS Northeast">
                        <td class="py-2 pl-6 pr-2 sticky-col"></td>
                        <td class="py-2 pl-10 px-3 text-xs text-neutral-700">
                          <button type="button" class="campaigns-account-expand-btn inline-flex items-center justify-center w-5 h-5 rounded hover:bg-neutral-200 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand locations" data-expand-for="black-friday-ups-northeast">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          UPS Northeast
                        </td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">208,000</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">58.5%</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">22.3%</a></td>
                        <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.5%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="black-friday-ups-northeast">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Boston</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">104,000</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">58.8%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">22.4%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.5%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="black-friday-ups-northeast">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Philadelphia</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">104,000</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">58.2%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">22.2%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.5%</a></td>
                      </tr>
                      <tr class="campaigns-child-row hidden" data-parent="black-friday" data-expand-id="black-friday-ups-southeast" data-account="UPS Southeast">
                        <td class="py-2 pl-6 pr-2 sticky-col"></td>
                        <td class="py-2 pl-10 px-3 text-xs text-neutral-700">
                          <button type="button" class="campaigns-account-expand-btn inline-flex items-center justify-center w-5 h-5 rounded hover:bg-neutral-200 text-neutral-500 hover:text-neutral-700 mr-2 align-middle" aria-label="Expand locations" data-expand-for="black-friday-ups-southeast">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                          </button>
                          UPS Southeast
                        </td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">312,000</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">57.9%</a></td>
                        <td class="py-2 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">21.9%</a></td>
                        <td class="py-2 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.7%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="black-friday-ups-southeast">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Atlanta</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">156,000</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">58.1%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">21.8%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.7%</a></td>
                      </tr>
                      <tr class="campaigns-location-row hidden" data-parent="black-friday-ups-southeast">
                        <td class="py-1.5 pl-6 pr-2 sticky-col"></td>
                        <td class="py-1.5 pl-16 px-3 text-xs text-neutral-600">Miami</td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">156,000</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">57.7%</a></td>
                        <td class="py-1.5 px-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">22.0%</a></td>
                        <td class="py-1.5 pr-6 pl-3 text-right text-xs"><a href="#" class="text-main-600 hover:underline">0.7%</a></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>

          <!-- Deliverability -->
          <section class="mb-8">
            <div class="funnel-card overflow-hidden">
              <div class="funnel-card-header border-b border-neutral-100 px-6 py-4">
                <h2 class="text-lg font-semibold text-neutral-900">Deliverability</h2>
                <p class="mt-1 text-sm text-neutral-700">Deliverability refers to whether your messages reach recipients, and it varies by channel. Understanding these differences can help improve performance.</p>
              </div>
              <div class="p-6">
                <div class="overflow-x-auto">
                  <table class="w-full min-w-[600px]">
                    <thead>
                      <tr class="bg-neutral-50 border-b border-neutral-100">
                        <th class="text-left py-3 px-3 text-sm font-semibold text-neutral-800">Sent</th>
                        <th class="text-right py-3 px-3 text-sm font-semibold text-neutral-800">Delivery rate</th>
                        <th class="text-right py-3 px-3 text-sm font-semibold text-neutral-800">Bounce rate</th>
                        <th class="text-right py-3 px-3 text-sm font-semibold text-neutral-800">Spam complaint rate</th>
                        <th class="text-right py-3 pr-6 pl-3 text-sm font-semibold text-neutral-800">Unsubscribe rate</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="border-b border-neutral-100 hover:bg-neutral-50/50 transition-colors">
                        <td class="py-4 px-3 text-sm text-neutral-900">8,990,000</td>
                        <td class="py-4 px-3 text-right text-sm">
                          <span class="font-medium text-neutral-900">99.4%</span>
                          <br><a href="#" class="text-xs text-main-600 hover:underline">8,936,060 recipients</a>
                        </td>
                        <td class="py-4 px-3 text-right text-sm">
                          <span class="font-medium text-neutral-900">0.6%</span>
                          <br><a href="#" class="text-xs text-main-600 hover:underline">53,940 recipients</a>
                        </td>
                        <td class="py-4 px-3 text-right text-sm">
                          <span class="font-medium text-neutral-900">0.0%</span>
                          <br><a href="#" class="text-xs text-main-600 hover:underline">90 recipients</a>
                        </td>
                        <td class="py-4 pr-6 pl-3 text-right text-sm">
                          <span class="font-medium text-neutral-900">0.1%</span>
                          <br><a href="#" class="text-xs text-main-600 hover:underline">8,990 recipients</a>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>

          <hr class="border-neutral-200 my-6">
          <div class="flex justify-center mb-6">
            <button type="button" id="feedback-trigger" class="text-sm font-medium text-main-600 hover:underline">Provide feedback and help us improve</button>
          </div>

          <!-- Feedback modal -->
          <div id="feedback-modal" class="fixed inset-0 z-[9998] hidden flex items-center justify-center p-4" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="feedback-modal-title">
            <div class="absolute inset-0 bg-black/40" id="feedback-modal-backdrop"></div>
            <div class="relative w-full max-w-md rounded-2xl border border-neutral-200 bg-white shadow-2xl overflow-hidden">
              <div class="p-6 pb-5">
                <div class="flex items-start justify-between gap-4 mb-5">
                  <h3 id="feedback-modal-title" class="text-xl font-semibold text-neutral-900">Give us your feedback</h3>
                  <button type="button" id="feedback-modal-close" class="flex items-center justify-center w-9 h-9 rounded-lg text-neutral-400 hover:bg-neutral-100 hover:text-neutral-600 transition-colors shrink-0" aria-label="Close modal">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
                  </button>
                </div>
                <p class="text-sm text-neutral-600 mb-4">What was your experience while using product?</p>
                <div class="flex gap-2 mb-6" role="group" aria-label="Rate your experience">
                  <button type="button" class="feedback-emoji flex-1 min-w-0 flex items-center justify-center min-h-[52px] py-2 px-2 rounded-xl bg-neutral-100 hover:bg-neutral-200 transition-all border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-main-500 focus:ring-offset-2" data-rating="1" aria-pressed="false" title="Dissatisfied">
                    <span class="text-2xl leading-none" aria-hidden="true">😭</span>
                  </button>
                  <button type="button" class="feedback-emoji flex-1 min-w-0 flex items-center justify-center min-h-[52px] py-2 px-2 rounded-xl bg-neutral-100 hover:bg-neutral-200 transition-all border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-main-500 focus:ring-offset-2" data-rating="2" aria-pressed="false" title="Sad">
                    <span class="text-2xl leading-none" aria-hidden="true">😞</span>
                  </button>
                  <button type="button" class="feedback-emoji flex-1 min-w-0 flex items-center justify-center min-h-[52px] py-2 px-2 rounded-xl bg-neutral-100 hover:bg-neutral-200 transition-all border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-main-500 focus:ring-offset-2" data-rating="3" aria-pressed="false" title="Neutral">
                    <span class="text-2xl leading-none" aria-hidden="true">😐</span>
                  </button>
                  <button type="button" class="feedback-emoji flex-1 min-w-0 flex items-center justify-center min-h-[52px] py-2 px-2 rounded-xl bg-neutral-100 hover:bg-neutral-200 transition-all border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-main-500 focus:ring-offset-2" data-rating="4" aria-pressed="false" title="Okay">
                    <span class="text-2xl leading-none" aria-hidden="true">🙂</span>
                  </button>
                  <button type="button" class="feedback-emoji flex-1 min-w-0 flex items-center justify-center min-h-[52px] py-2 px-2 rounded-xl bg-neutral-100 hover:bg-neutral-200 transition-all border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-main-500 focus:ring-offset-2" data-rating="5" aria-pressed="false" title="Satisfied">
                    <span class="text-2xl leading-none" aria-hidden="true">🤩</span>
                  </button>
                </div>
                <label for="feedback-text" class="block text-sm font-semibold text-neutral-800 mb-1.5">Write your feedback <span class="font-normal text-neutral-500">(optional)</span></label>
                <textarea id="feedback-text" rows="4" placeholder="Please write here" class="w-full rounded-xl border border-neutral-200 px-3 py-2.5 text-sm text-neutral-900 placeholder:text-neutral-400 focus:ring-2 focus:ring-main-500 focus:border-main-500 focus:outline-none resize-none min-h-[88px]"></textarea>
              </div>
              <div class="px-6 pb-6 pt-1">
                <button type="button" id="feedback-submit" class="w-full rounded-xl bg-main-600 py-3 text-sm font-semibold text-white hover:bg-main-700 focus:outline-none focus:ring-2 focus:ring-main-500 focus:ring-offset-2 transition-colors">Submit</button>
              </div>
            </div>
          </div>

          <!-- Compare modal -->
          <div id="compare-modal" class="fixed inset-0 z-[9998] hidden" aria-hidden="true">
            <div class="absolute inset-0 bg-black/40" id="compare-modal-backdrop"></div>
            <div class="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-4xl max-h-[90vh] rounded-xl border border-neutral-200 bg-white shadow-xl flex flex-col">
              <div class="flex items-center justify-between border-b border-neutral-100 px-6 py-4 flex-shrink-0">
                <h3 class="text-lg font-semibold text-neutral-900">Comparison view</h3>
                <div class="flex items-center gap-2">
                  <button type="button" class="rounded-lg border border-neutral-200 px-3 py-1.5 text-sm font-medium text-neutral-700 hover:bg-neutral-50">Export</button>
                  <button type="button" id="compare-modal-close" class="rounded-lg border border-neutral-200 px-3 py-1.5 text-sm font-medium text-neutral-700 hover:bg-neutral-50">Close</button>
                </div>
              </div>
              <div class="p-4 border-b border-neutral-100 flex flex-wrap gap-2" id="compare-chips"></div>
              <div class="overflow-auto flex-1 p-4 compare-table-wrap">
                <div id="compare-empty" class="hidden py-12 text-center text-neutral-500 text-sm">Select at least two accounts to compare.</div>
                <div id="compare-loading" class="hidden py-12 text-center text-neutral-500 text-sm">Loading comparison...</div>
                <table id="compare-table" class="w-full min-w-[600px] hidden">
                  <thead>
                    <tr class="border-b border-neutral-200 text-xs font-medium text-neutral-500 uppercase tracking-wide">
                      <th class="text-left py-3 pl-4 pr-2 sticky-col bg-white">Metric</th>
                      <th class="text-right py-3 px-2">Account 1</th>
                      <th class="text-right py-3 px-2">Account 2</th>
                    </tr>
                  </thead>
                  <tbody id="compare-tbody" class="divide-y divide-neutral-100"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Milestone Bar (M0–M5, reusable component) -->
  <div id="milestone-bar-root"></div>
  <script src="components/milestone-bar.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      if (typeof renderMilestoneBar === 'function') {
        var milestone = 'm1';
        try {
          var params = new URLSearchParams(window.location.search);
          var fromUrl = params.get('milestone');
          if (fromUrl && /^m[1-5]$/i.test(fromUrl)) {
            milestone = fromUrl.toLowerCase();
          } else {
            var fromStorage = sessionStorage.getItem('emailReportMilestone');
            if (fromStorage && /^m[1-5]$/.test(fromStorage)) milestone = fromStorage;
            sessionStorage.removeItem('emailReportMilestone');
          }
        } catch (e) {}
        renderMilestoneBar('milestone-bar-root', { active: milestone });
      }
    });
  </script>

  <script>
    function toggleSidebar() {
      var sidebar = document.getElementById('sidebar');
      var backdrop = document.getElementById('sidebar-backdrop');
      if (sidebar) sidebar.classList.toggle('-translate-x-full');
      if (backdrop) backdrop.classList.toggle('hidden');
    }
  </script>
  <script>
    (function () {
      if (document.getElementById('sidebar-content')) {
        try { renderLeftNav('sidebar-content', { activeId: 'reports' }); } catch (e) {}
      }
    })();
  </script>
  <script>
    (function () {
      var sentinel = document.getElementById('sticky-header-sentinel');
      var header = document.getElementById('sticky-header');
      if (!sentinel || !header) return;
      var observer = new IntersectionObserver(function (entries) {
        entries.forEach(function (entry) {
          var stuck = !entry.isIntersecting && entry.boundingClientRect.top < 0;
          header.classList.toggle('is-stuck', stuck);
          document.body.classList.toggle('sticky-header-stuck', stuck);
        });
      }, { threshold: 0, rootMargin: '0px' });
      observer.observe(sentinel);
    })();
  </script>
  <script>
    (function () {
      var yourInsightsSection = document.getElementById('performance-funnel-section');
      var header = document.getElementById('sticky-header');
      if (yourInsightsSection && header) {
        var hasSeenYourInsights = false;
        var observer = new IntersectionObserver(function (entries) {
          entries.forEach(function (entry) {
            if (entry.isIntersecting) hasSeenYourInsights = true;
            header.classList.toggle('your-insights-visible', hasSeenYourInsights);
          });
        }, { threshold: 0.3, rootMargin: '0px' });
        observer.observe(yourInsightsSection);
      }
    })();
  </script>
  <script>
    (function () {
      var funnelSection = document.getElementById('performance-funnel-section-2');
      var funnelWrapper = funnelSection ? funnelSection.querySelector('.funnel-wrapper') : null;
      if (!funnelWrapper) return;
      var observer = new IntersectionObserver(function (entries) {
        entries.forEach(function (entry) {
          if (entry.isIntersecting) funnelWrapper.classList.add('funnel-in-view');
        });
      }, { threshold: 0.15, rootMargin: '0px' });
      observer.observe(funnelSection);
    })();
  </script>
  <script>
    (function () {
      var wrapper = document.querySelector('#performance-funnel-section-2 .funnel-wrapper');
      if (!wrapper) return;
      var segments = wrapper.querySelectorAll('.funnel-viz .funnel-segment[data-funnel-stage]');
      var bars = wrapper.querySelectorAll('.funnel-label-bar[data-funnel-stage]');
      function highlightStage(stage, on) {
        var s = stage ? wrapper.querySelector('.funnel-viz .funnel-segment[data-funnel-stage="' + stage + '"]') : null;
        var b = stage ? wrapper.querySelector('.funnel-label-bar[data-funnel-stage="' + stage + '"]') : null;
        if (s) s.classList.toggle('funnel-stage-hover', !!on);
        if (b) b.classList.toggle('funnel-stage-hover', !!on);
      }
      function clearHighlight() {
        segments.forEach(function (el) { el.classList.remove('funnel-stage-hover'); });
        bars.forEach(function (el) { el.classList.remove('funnel-stage-hover'); });
      }
      segments.forEach(function (el) {
        el.addEventListener('mouseenter', function () { highlightStage(el.getAttribute('data-funnel-stage'), true); });
        el.addEventListener('mouseleave', clearHighlight);
      });
      bars.forEach(function (el) {
        el.addEventListener('mouseenter', function () { highlightStage(el.getAttribute('data-funnel-stage'), true); });
        el.addEventListener('mouseleave', clearHighlight);
      });
    })();
  </script>
  <script>
    (function () {
      var funnelAskInput = document.getElementById('funnel-ask-input');
      if (!funnelAskInput) return;
      var placeholders = [
        'Why did my engagement change?',
        'Explain my funnel performance',
        'Identify the weakest stage in this funnel',
        'What should I optimize next?'
      ];
      var index = 0;
      setInterval(function () {
        index = (index + 1) % placeholders.length;
        funnelAskInput.placeholder = placeholders[index];
      }, 2000);
    })();
  </script>
  <script>
    (function () {
      var exportModal = document.getElementById('export-modal');
      var exportBtn = document.getElementById('export-btn');
      var exportModalBackdrop = document.getElementById('export-modal-backdrop');
      var exportModalCancel = document.getElementById('export-modal-cancel');
      var exportModalExport = document.getElementById('export-modal-export');
      var exportReportTypeTrigger = document.getElementById('export-report-type-trigger');
      var exportReportTypeDropdown = document.getElementById('export-report-type-dropdown');
      var exportReportTypeLabel = document.getElementById('export-report-type-label');
      var exportReportsTrigger = document.getElementById('export-reports-trigger');
      var exportReportsDropdown = document.getElementById('export-reports-dropdown');
      var exportReportsLabel = document.getElementById('export-reports-label');

      var REPORT_IDS = {
        'Full report': 'full',
        'Engagement funnel': 'funnel',
        'Engagement by accounts': 'accounts',
        'Engagement by campaign': 'campaign',
        'Deliverability': 'deliverability'
      };
      function openExportModal() {
        exportModal.classList.remove('hidden');
        exportModal.setAttribute('aria-hidden', 'false');
      }
      function closeExportModal() {
        exportModal.classList.add('hidden');
        exportModal.setAttribute('aria-hidden', 'true');
        exportReportTypeDropdown.classList.add('hidden');
        exportReportsDropdown.classList.add('hidden');
      }

      exportBtn.addEventListener('click', openExportModal);
      exportModalBackdrop.addEventListener('click', closeExportModal);
      exportModalCancel.addEventListener('click', closeExportModal);

      exportReportTypeTrigger.addEventListener('click', function (e) {
        e.stopPropagation();
        exportReportsDropdown.classList.add('hidden');
        exportReportTypeDropdown.classList.toggle('hidden');
      });
      exportReportsTrigger.addEventListener('click', function (e) {
        e.stopPropagation();
        exportReportTypeDropdown.classList.add('hidden');
        exportReportsDropdown.classList.toggle('hidden');
      });

      document.querySelectorAll('.export-type-option').forEach(function (el) {
        el.addEventListener('click', function () {
          exportReportTypeLabel.textContent = this.getAttribute('data-value');
          exportReportTypeDropdown.classList.add('hidden');
        });
      });

      var dropdownChecks = document.querySelectorAll('.export-report-check');
      var fullCheck = document.getElementById('export-check-full');

      function syncDropdownLabel() {
        var selected = [];
        dropdownChecks.forEach(function (cb) {
          if (cb.checked) selected.push(cb.getAttribute('data-report'));
        });
        if (selected.length === 0) exportReportsLabel.textContent = 'Select reports';
        else if (selected.length === 1) exportReportsLabel.textContent = selected[0];
        else exportReportsLabel.textContent = selected.length + ' reports selected';
      }

      if (fullCheck) {
        fullCheck.addEventListener('change', function () {
          if (fullCheck.checked) {
            dropdownChecks.forEach(function (cb) {
              if (cb.getAttribute('data-report') !== 'Full report') cb.checked = false;
            });
          }
          syncDropdownLabel();
        });
      }

      dropdownChecks.forEach(function (cb) {
        cb.addEventListener('change', function () {
          if (cb.getAttribute('data-report') === 'Full report' && cb.checked) {
            dropdownChecks.forEach(function (other) { if (other !== cb) other.checked = false; });
          } else if (fullCheck) fullCheck.checked = false;
          syncDropdownLabel();
        });
      });

      function getSelectedReportIds() {
        if (fullCheck && fullCheck.checked) return ['full'];
        var ids = [];
        dropdownChecks.forEach(function (cb) {
          if (cb.checked && cb.getAttribute('data-report') !== 'Full report') {
            var id = REPORT_IDS[cb.getAttribute('data-report')];
            if (id) ids.push(id);
          }
        });
        return ids.length ? ids : ['full'];
      }

      exportModalExport.addEventListener('click', function () {
        var format = exportReportTypeLabel.textContent.trim();
        var reportIds = getSelectedReportIds();
        console.log('Export submit:', { format: format, reportIds: reportIds });
        closeExportModal();
        var toast = document.getElementById('export-toast');
        if (toast) {
          toast.classList.remove('hidden');
          toast.textContent = 'Report is downloading';
          setTimeout(function () { toast.classList.add('hidden'); }, 3000);
        }
      });

      document.addEventListener('click', function (e) {
        if (exportModal.classList.contains('hidden')) return;
        if (!exportReportTypeTrigger.contains(e.target) && !exportReportTypeDropdown.contains(e.target)) exportReportTypeDropdown.classList.add('hidden');
        if (!exportReportsTrigger.contains(e.target) && !exportReportsDropdown.contains(e.target)) exportReportsDropdown.classList.add('hidden');
      });
    })();
  </script>
  <script>
    (function () {
      var closeBtn = document.getElementById('ai-panel-close');
      var minimizeBtn = document.getElementById('ai-panel-minimize');
      var floatBtn = document.getElementById('ai-insights-float-btn');
      var askInput = document.getElementById('ai-ask-input');
      var askSubmit = document.getElementById('ai-ask-submit');
      var conversation = document.getElementById('ai-chat-conversation');
      var welcome = document.getElementById('ai-chat-welcome');
      var messagesContainer = document.getElementById('ai-chat-messages');
      var typingEl = document.getElementById('ai-chat-typing');
      var bodyEl = document.getElementById('body-el');

      function hideFloat() {
        if (floatBtn) floatBtn.classList.remove('visible');
      }
      function showFloat() {
        if (floatBtn) floatBtn.classList.add('visible');
      }
      function resetRevealSteps() {
        var w = document.getElementById('ai-chat-welcome');
        if (!w) return;
        w.querySelectorAll('.ai-reveal-step').forEach(function (el) { el.classList.remove('visible'); });
        var card = document.getElementById('ai-insights-card');
        if (card) card.classList.add('loading');
      }
      function runRevealSequence() {
        try {
          var w = document.getElementById('ai-chat-welcome');
          var insightsCard = document.getElementById('ai-insights-card');
          var insightsSection = document.getElementById('ai-insights-section');
          var steps = w ? Array.prototype.slice.call(w.querySelectorAll('.ai-reveal-step'), 0) : [];
          steps.sort(function (a, b) { return (parseInt(a.getAttribute('data-reveal-order'), 10) || 0) - (parseInt(b.getAttribute('data-reveal-order'), 10) || 0); });
          var accountSpotlight = steps[1];
          var helpWith = steps[2];
          if (insightsSection) insightsSection.classList.add('visible');
          if (insightsCard) insightsCard.classList.add('loading');
          setTimeout(function () {
            try {
              if (insightsCard) insightsCard.classList.remove('loading');
              if (accountSpotlight) accountSpotlight.classList.add('visible');
              setTimeout(function () {
                if (helpWith) helpWith.classList.add('visible');
              }, 380);
            } catch (e) { if (w) w.querySelectorAll('.ai-reveal-step').forEach(function (el) { el.classList.add('visible'); }); if (insightsCard) insightsCard.classList.remove('loading'); }
          }, 1200);
        } catch (e) {
          var w = document.getElementById('ai-chat-welcome');
          if (w) w.querySelectorAll('.ai-reveal-step').forEach(function (el) { el.classList.add('visible'); });
          var card = document.getElementById('ai-insights-card');
          if (card) card.classList.remove('loading');
        }
      }

      function openAiPanel() {
        var panel = document.getElementById('ai-insights-panel');
        var backdrop = document.getElementById('ai-insights-panel-backdrop');
        var w = document.getElementById('ai-chat-welcome');
        if (panel) { panel.classList.remove('hidden'); panel.classList.add('ai-panel-visible'); }
        if (backdrop) { backdrop.classList.remove('hidden'); backdrop.classList.add('ai-panel-visible'); }
        hideFloat();
        if (bodyEl) bodyEl.classList.add('scroll-lock');
        document.documentElement.classList.add('ai-panel-open');
        resetRevealSteps();
        if (w) w.style.display = '';
        setTimeout(runRevealSequence, 50);
      }
      function closeAiPanel() {
        var panel = document.getElementById('ai-insights-panel');
        var backdrop = document.getElementById('ai-insights-panel-backdrop');
        if (panel) { panel.classList.add('hidden'); panel.classList.remove('ai-panel-visible'); }
        if (backdrop) { backdrop.classList.add('hidden'); backdrop.classList.remove('ai-panel-visible'); }
        hideFloat();
        if (bodyEl) bodyEl.classList.remove('scroll-lock');
        document.documentElement.classList.remove('ai-panel-open');
        resetRevealSteps();
      }
      function minimizePanel() {
        var panel = document.getElementById('ai-insights-panel');
        var backdrop = document.getElementById('ai-insights-panel-backdrop');
        if (panel) { panel.classList.add('hidden'); panel.classList.remove('ai-panel-visible'); }
        if (backdrop) { backdrop.classList.add('hidden'); backdrop.classList.remove('ai-panel-visible'); }
        showFloat();
        if (bodyEl) bodyEl.classList.remove('scroll-lock');
        document.documentElement.classList.remove('ai-panel-open');
      }

      function toggleAiPanel(e) {
        if (e) e.preventDefault();
        var panel = document.getElementById('ai-insights-panel');
        if (!panel) return;
        if (panel.classList.contains('hidden') || !panel.classList.contains('ai-panel-visible')) openAiPanel();
        else closeAiPanel();
      }
      window.toggleAiInsightsPanel = toggleAiPanel;
      window.openAiPanel = openAiPanel;

      document.body.addEventListener('click', function (e) {
        if (e.target.closest && e.target.closest('.ai-insights-trigger')) {
          toggleAiPanel(e);
        }
      });
      if (closeBtn) closeBtn.addEventListener('click', closeAiPanel);
      if (minimizeBtn) minimizeBtn.addEventListener('click', minimizePanel);
      if (floatBtn) floatBtn.addEventListener('click', openAiPanel);

      function scrollChatToBottom() {
        if (conversation) conversation.scrollTop = conversation.scrollHeight;
      }

      function getBotResponse(question) {
        var q = (question || '').toLowerCase();
        if (q.indexOf('under perform') !== -1 || q.indexOf('underperforming') !== -1 || q.indexOf('under performing') !== -1) {
          return 'Based on the selected period, <strong>UPS Midwest</strong> is underperforming: open rate is below 50% and click-through is lagging. <strong>UPS Southeast</strong> is also slightly below average. I recommend list hygiene, A/B testing subject lines, and reviewing send times for these accounts. You can filter the Engagement by account table to "Needs attention" to see them in context.';
        }
        if (q.indexOf('performance drop') !== -1 || q.indexOf('performance dropped') !== -1 || q.indexOf('why did my') !== -1 && (q.indexOf('drop') !== -1 || q.indexOf('decline') !== -1) || q.indexOf('why dropped') !== -1 || q.indexOf('why the drop') !== -1) {
          return '<p><strong>Why performance dropped</strong></p><p>Compared to last period: <strong>open rate is down 7.8%</strong> and <strong>click-through rate is down 4.4%</strong>. Likely drivers include weaker subject-line appeal (fewer opens), less engaging CTAs or content (fewer clicks), and some underperforming segments—especially <strong>UPS Midwest</strong> and low-open segments pulling the average down.</p><p><strong>What you can do to improve</strong></p><p>(1) <strong>Subject lines & send times</strong> — Run A/B tests on subject lines and test send times to lift opens. (2) <strong>CTAs & content</strong> — Improve call-to-action placement and copy in underperforming campaigns to boost clicks. (3) <strong>UPS Midwest & low-open segments</strong> — Review list quality, segmentation, and creative for these; consider tactics that work for top performer UPS Northeast. (4) <strong>List hygiene</strong> — Keep suppressing bounces and cleaning the list; delivery and volume are in good shape.</p>';
        }
        if (q.indexOf('last 7 days') !== -1 || q.indexOf('7 days') !== -1 || q.indexOf('overall') !== -1 && (q.indexOf('engagement') !== -1 || q.indexOf('email') !== -1)) {
          return 'For the last 7 days, overall email engagement looks solid: <strong>65% open rate</strong> and <strong>26.2% click-through</strong>. Sends are up 5.2% vs the prior period; delivery rate is 99.4% and bounce rate improved. Open rate is down 7.8% vs last period—testing subject lines and send times could help. Top performer is UPS Northeast (72% open, 31% CTR).';
        }
        if (q.indexOf('northwest') !== -1 || q.indexOf('north west') !== -1) {
          return 'For <strong>Northwest Branch</strong>: in the selected period it’s in the UPS Northeast region. Opens are around 71% with a 30% click rate—above average. Strong subject lines and segment targeting are driving results. To dig deeper, use the Engagement by account table and expand UPS Northeast to see sub-accounts.';
        }
        if (q.indexOf('focus') !== -1 || q.indexOf('improve') !== -1 || q.indexOf('what should') !== -1) {
          return 'Here’s what to focus on: (1) <strong>Subject lines and CTAs</strong>—open and click rates are down vs last period; try A/B tests. (2) <strong>UPS Midwest</strong>—needs attention; improve list quality and send times. (3) <strong>Top performers</strong>—learn from UPS Northeast’s segmentation and creative. (4) Keep list hygiene and bounce suppression in place; they’re working well.';
        }
        return 'Here’s a quick snapshot of your email performance for the selected period: <strong>65% open rate</strong>, <strong>26.2% click-through</strong>, and <strong>99.4% delivery</strong>. Top performer is UPS Northeast; UPS Midwest needs attention with opens below 50%. You can ask me to identify underperforming accounts, summarize last 7 days engagement, get insights on a specific branch, or what to focus on next.';
      }

      function isUnderperformingIntent(question) {
        var q = (question || '').toLowerCase();
        return q.indexOf('under perform') !== -1 || q.indexOf('underperforming') !== -1 || q.indexOf('under performing') !== -1 || q.indexOf('identify which accounts') !== -1;
      }

      function appendMessage(role, text) {
        if (!messagesContainer) return;
        messagesContainer.classList.remove('hidden');
        var wrap = document.createElement('div');
        wrap.className = role === 'user' ? 'ai-chat-bubble-user' : 'ai-chat-bubble-bot';
        if (role === 'bot') {
          var avatar = document.createElement('div');
          avatar.className = 'ai-chat-bot-avatar';
          avatar.setAttribute('aria-hidden', 'true');
          avatar.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>';
          var content = document.createElement('div');
          content.className = 'ai-chat-bot-content';
          content.innerHTML = text;
          wrap.appendChild(avatar);
          wrap.appendChild(content);
        } else {
          wrap.textContent = text;
        }
        messagesContainer.appendChild(wrap);
        scrollChatToBottom();
      }

      function appendBotMessageWithActions(html) {
        if (!messagesContainer) return;
        messagesContainer.classList.remove('hidden');
        var wrap = document.createElement('div');
        wrap.className = 'ai-chat-bubble-bot';
        var avatar = document.createElement('div');
        avatar.className = 'ai-chat-bot-avatar';
        avatar.setAttribute('aria-hidden', 'true');
        avatar.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>';
        var content = document.createElement('div');
        content.className = 'ai-chat-bot-content';
        content.innerHTML = html;
        wrap.appendChild(avatar);
        wrap.appendChild(content);
        messagesContainer.appendChild(wrap);
        content.querySelectorAll('.ai-chat-action-btn').forEach(function (btn) {
          btn.addEventListener('click', function () {
            var action = this.getAttribute('data-action');
            if (action === 'view-dashboard') {
              appendMessage('user', 'View these in your dashboard');
              setTimeout(function () {
                appendMessage('bot', 'Showing the filtered table for underperforming accounts.');
              }, 400);
              setTimeout(function () {
                if (typeof minimizePanel === 'function') minimizePanel();
                var section = document.getElementById('engagement-by-account-section');
                if (section) section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                var pill = document.querySelector('.accounts-pill[data-filter="attention"]');
                if (pill) pill.click();
              }, 600);
            } else if (action === 'export-report') {
              appendMessage('user', 'Export this report');
              setTimeout(function () {
                appendMessage('bot', 'Report is downloading.');
                var toast = document.getElementById('export-toast');
                if (toast) {
                  toast.classList.remove('hidden');
                  toast.textContent = 'Report is downloading';
                  setTimeout(function () { toast.classList.add('hidden'); }, 3000);
                }
              }, 600);
            } else if (action === 'suggest-improve') {
              appendMessage('user', 'Give me tips to improve performance');
              setTimeout(function () {
                appendMessage('bot', '<p><strong>Tips to improve performance</strong></p><p>(1) <strong>List hygiene & segmentation</strong> — Clean lists and use better segments so messages stay relevant.</p><p>(2) <strong>A/B test subject lines and send times</strong> — Test different subject lines and send times to lift opens and clicks.</p><p>(3) <strong>CTAs and content</strong> — Improve call-to-action placement and copy in underperforming campaigns.</p><p>(4) <strong>Learn from top performers</strong> — Replicate what works for <strong>UPS Northeast</strong> (segmentation, creative, send patterns) in underperforming accounts like UPS Midwest.</p>');
              }, 600);
            }
          });
        });
        scrollChatToBottom();
      }

      function sendMessage(question) {
        question = (question || '').trim();
        if (!question) return;
        if (!isUnderperformingIntent(question)) appendMessage('user', question);
        if (askInput) askInput.value = '';
        if (typingEl) typingEl.classList.remove('hidden');
        scrollChatToBottom();

        if (isUnderperformingIntent(question)) {
          appendMessage('bot', 'Sure, let me find which accounts are underperforming.');
          setTimeout(function () {
            if (typingEl) typingEl.classList.add('hidden');
            var followUpHtml = '<p>I have found accounts that are underperforming:</p><ul><li><strong>UPS Midwest</strong> — open rate below 50%, click-through lagging</li><li><strong>UPS Southeast</strong> — slightly below average</li></ul><p><strong>What do you want to do next?</strong></p><div class="ai-chat-follow-up-actions"><button type="button" class="ai-chat-action-btn" data-action="view-dashboard">View these in your dashboard</button><button type="button" class="ai-chat-action-btn" data-action="export-report">Export this report</button><button type="button" class="ai-chat-action-btn" data-action="suggest-improve">Suggest ways to improve</button></div>';
            appendBotMessageWithActions(followUpHtml);
          }, 1600);
        } else {
          setTimeout(function () {
            if (typingEl) typingEl.classList.add('hidden');
            appendMessage('bot', getBotResponse(question));
          }, 800 + Math.min(400, question.length * 20));
        }
      }

      if (askSubmit && askInput) {
        askSubmit.addEventListener('click', function () { sendMessage(askInput.value); });
        askInput.addEventListener('keydown', function (e) {
          if (e.key === 'Enter') { e.preventDefault(); sendMessage(askInput.value); }
        });
      }
      document.querySelectorAll('.ai-suggested-prompt').forEach(function (btn) {
        btn.addEventListener('click', function () {
          var p = this.getAttribute('data-prompt');
          if (p) sendMessage(p);
        });
      });
      document.querySelectorAll('.ai-view-account').forEach(function (btn) {
        btn.addEventListener('click', function () {
          var account = this.getAttribute('data-account');
          closeAiPanel();
          var section = document.getElementById('engagement-by-account-section');
          if (section) section.scrollIntoView({ behavior: 'smooth' });
          var pill = document.querySelector('.accounts-pill[data-filter="attention"]');
          if (account === 'UPS Midwest' && pill) pill.click();
        });
      });
    })();
  </script>
  <script>
    (function () {
      function setupColumnVisibility(triggerId, dropdownId, tableId, toggleClass) {
        var trigger = document.getElementById(triggerId);
        var dropdown = document.getElementById(dropdownId);
        var table = document.getElementById(tableId);
        if (!trigger || !dropdown || !table) return;
        trigger.addEventListener('click', function (e) {
          e.stopPropagation();
          var open = !dropdown.classList.contains('hidden');
          dropdown.classList.toggle('hidden', open);
          trigger.setAttribute('aria-expanded', open ? 'false' : 'true');
        });
        document.addEventListener('click', function () {
          dropdown.classList.add('hidden');
          trigger.setAttribute('aria-expanded', 'false');
        });
        dropdown.addEventListener('click', function (e) { e.stopPropagation(); });
        dropdown.querySelectorAll('.' + toggleClass).forEach(function (cb) {
          cb.addEventListener('change', function () {
            var col = parseInt(cb.getAttribute('data-col'), 10);
            var visible = cb.checked;
            var selector = 'th:nth-child(' + col + '), td:nth-child(' + col + ')';
            table.querySelectorAll(selector).forEach(function (cell) {
              cell.style.display = visible ? '' : 'none';
            });
          });
        });
      }
      setupColumnVisibility('accounts-table-columns-trigger', 'accounts-table-columns-dropdown', 'accounts-table', 'accounts-column-toggle');
      setupColumnVisibility('campaigns-table-columns-trigger', 'campaigns-table-columns-dropdown', 'campaigns-table', 'campaigns-column-toggle');
    })();
  </script>
  <script>
    (function () {
      var dateTrigger = document.getElementById('date-range-trigger');
      var dateLabel = document.getElementById('date-range-label');
      var dateDropdown = document.getElementById('date-range-dropdown');
      var dateCustomBtn = document.getElementById('date-range-custom-btn');
      var dateCustomPanel = document.getElementById('date-range-custom-panel');
      var dateStart = document.getElementById('date-range-start');
      var dateEnd = document.getElementById('date-range-end');
      var dateApply = document.getElementById('date-range-apply');

      function formatDate(d) {
        var m = d.getMonth(), day = d.getDate(), y = d.getFullYear();
        var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        return months[m] + ' ' + day + ', ' + y;
      }

      function getRangeForValue(val) {
        var end = new Date();
        var start = new Date();
        if (val === 'ytd') {
          start = new Date(end.getFullYear(), 0, 1);
        } else {
          var days = parseInt(val, 10) || 30;
          start.setDate(start.getDate() - days);
        }
        return { start: start, end: end };
      }

      function updateDatePreviews() {
        [7, 30, 90, 365, 'ytd'].forEach(function (val) {
          var el = document.getElementById('date-range-preview-' + val);
          if (!el) return;
          var r = getRangeForValue(val);
          el.textContent = formatDate(r.start) + ' – ' + formatDate(r.end);
        });
      }

      function getLabelForValue(val) {
        if (val === '7') return 'Last 7 days';
        if (val === '30') return 'Last 30 days';
        if (val === '90') return 'Last 90 days';
        if (val === '365') return '12 months';
        if (val === 'ytd') return 'Year to date';
        return 'Custom range';
      }

      dateTrigger.addEventListener('click', function (e) {
        e.stopPropagation();
        dateDropdown.classList.toggle('hidden');
        if (!dateDropdown.classList.contains('hidden')) {
          updateDatePreviews();
          if (dateCustomPanel) dateCustomPanel.classList.add('hidden');
        }
      });

      document.querySelectorAll('.date-range-option').forEach(function (el) {
        el.addEventListener('click', function (e) {
          e.stopPropagation();
          var val = this.getAttribute('data-value');
          dateLabel.textContent = getLabelForValue(val);
          dateLabel.setAttribute('data-value', val);
          dateDropdown.classList.add('hidden');
          if (typeof window.updateSummaryCards === 'function') window.updateSummaryCards();
        });
      });

      if (dateCustomBtn) {
        dateCustomBtn.addEventListener('click', function (e) {
          e.stopPropagation();
          var panel = document.getElementById('date-range-custom-panel');
          if (panel.classList.contains('hidden')) {
            var end = new Date();
            var start = new Date();
            start.setDate(start.getDate() - 30);
            if (dateStart) dateStart.value = start.toISOString().slice(0, 10);
            if (dateEnd) dateEnd.value = end.toISOString().slice(0, 10);
            panel.classList.remove('hidden');
          } else {
            panel.classList.add('hidden');
          }
        });
      }

      if (dateApply && dateStart && dateEnd) {
        dateApply.addEventListener('click', function (e) {
          e.stopPropagation();
          var s = dateStart.value;
          var d = dateEnd.value;
          if (s && d) {
            var startStr = formatDate(new Date(s));
            var endStr = formatDate(new Date(d));
            dateLabel.textContent = startStr + ' – ' + endStr;
            dateLabel.setAttribute('data-value', 'custom');
            if (dateCustomPanel) dateCustomPanel.classList.add('hidden');
            dateDropdown.classList.add('hidden');
            if (typeof window.updateSummaryCards === 'function') window.updateSummaryCards();
          }
        });
      }

      document.addEventListener('click', function () {
        dateDropdown.classList.add('hidden');
      });
    })();
  </script>
  <script>
    (function () {
      var tablist = document.querySelector('[role="tablist"][aria-label="Insights type"]');
      var insightTags = tablist ? tablist.querySelectorAll('.insights-tag') : document.querySelectorAll('.insights-tag');
      var tabs = Array.prototype.slice.call(insightTags, 0);
      var panelIds = { email: 'insights-panel-email', account: 'insights-panel-account', campaign: 'insights-panel-campaign' };
      function selectTab(btn) {
        tabs.forEach(function (b) {
          b.classList.remove('active');
          b.setAttribute('aria-pressed', 'false');
          b.setAttribute('aria-selected', 'false');
          b.setAttribute('tabindex', '-1');
        });
        if (btn) {
          btn.classList.add('active');
          btn.setAttribute('aria-pressed', 'true');
          btn.setAttribute('aria-selected', 'true');
          btn.setAttribute('tabindex', '0');
          var tag = btn.getAttribute('data-insight-tag');
          Object.keys(panelIds).forEach(function (key) {
            var panel = document.getElementById(panelIds[key]);
            if (panel) {
              if (key === tag) {
                panel.classList.remove('hidden');
                panel.setAttribute('aria-hidden', 'false');
              } else {
                panel.classList.add('hidden');
                panel.setAttribute('aria-hidden', 'true');
              }
            }
          });
        }
      }
      tabs.forEach(function (btn, i) {
        btn.addEventListener('click', function () { selectTab(this); });
        btn.addEventListener('keydown', function (e) {
          var idx = tabs.indexOf(this);
          if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
            e.preventDefault();
            selectTab(tabs[idx - 1] || tabs[tabs.length - 1]);
            (tabs[idx - 1] || tabs[tabs.length - 1]).focus();
          } else if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
            e.preventDefault();
            selectTab(tabs[idx + 1] || tabs[0]);
            (tabs[idx + 1] || tabs[0]).focus();
          } else if (e.key === 'Home') {
            e.preventDefault();
            selectTab(tabs[0]);
            tabs[0].focus();
          } else if (e.key === 'End') {
            e.preventDefault();
            selectTab(tabs[tabs.length - 1]);
            tabs[tabs.length - 1].focus();
          }
        });
      });
    })();
  </script>
  <script>
    (function () {
      var trigger = document.getElementById('accounts-multiselect-trigger');
      var dropdown = document.getElementById('accounts-multiselect-dropdown');
      var label = document.getElementById('accounts-multiselect-label');
      var clearBtn = document.getElementById('accounts-multiselect-clear');
      var checks = document.querySelectorAll('.accounts-multiselect-check');
      var allCheck = document.querySelector('.accounts-multiselect-check[data-account="all"]');
      var otherChecks = document.querySelectorAll('.accounts-multiselect-check:not([data-account="all"])');

      function getSelectedAccounts() {
        if (allCheck && allCheck.checked) return null;
        var selected = Array.from(otherChecks).filter(function (c) { return c.checked; }).map(function (c) { return c.getAttribute('data-account'); });
        return selected.length === 0 ? null : selected;
      }

      function updateLabel() {
        var selected = getSelectedAccounts();
        if (selected === null) {
          label.textContent = 'All accounts';
        } else if (selected.length === 1) {
          label.textContent = selected[0];
        } else {
          label.textContent = selected.length + ' accounts selected';
        }
      }

      function updateClearButtonState() {
        if (!clearBtn) return;
        var isAllSelected = allCheck && allCheck.checked;
        clearBtn.disabled = isAllSelected;
        clearBtn.setAttribute('aria-disabled', isAllSelected ? 'true' : 'false');
      }

      function filterTableBySelectedAccounts() {
        var selected = getSelectedAccounts();
        var showAllAccounts = selected === null;
        var activePill = document.querySelector('.accounts-pill.bg-main-100, .accounts-pill.text-main-800');
        var pillFilter = activePill ? activePill.getAttribute('data-filter') : 'all';
        var table = document.getElementById('accounts-table');
        if (!table) return;
        var parentRows = table.querySelectorAll('.accounts-parent-row');
        var childRows = table.querySelectorAll('.accounts-child-row');
        parentRows.forEach(function (row) {
          var account = row.getAttribute('data-account');
          var tier = row.getAttribute('data-tier');
          var accountShow = showAllAccounts || (selected && selected.indexOf(account) !== -1);
          var pillShow = pillFilter === 'all' || tier === pillFilter;
          row.style.display = accountShow && pillShow ? 'table-row' : 'none';
        });
        childRows.forEach(function (row) {
          var parentAccount = row.getAttribute('data-parent');
          var parentRow = table.querySelector('.accounts-parent-row[data-account="' + parentAccount + '"]');
          var parentVisible = parentRow && parentRow.style.display !== 'none';
          if (!parentVisible) {
            row.style.display = 'none';
          } else {
            row.style.display = row.classList.contains('hidden') ? 'none' : 'table-row';
          }
        });
      }

      function filterCampaignsTableBySelectedAccounts() {
        var selected = getSelectedAccounts();
        var showAllAccounts = selected === null;
        var campaignsTable = document.getElementById('campaigns-table');
        if (!campaignsTable) return;
        var parentRows = campaignsTable.querySelectorAll('.campaigns-parent-row');
        var accountRows = campaignsTable.querySelectorAll('.campaigns-child-row');
        var locationRows = campaignsTable.querySelectorAll('.campaigns-location-row');
        accountRows.forEach(function (row) {
          var account = row.getAttribute('data-account');
          var show = showAllAccounts || (selected && selected.indexOf(account) !== -1);
          row.style.display = show ? '' : 'none';
        });
        var segment = typeof window.currentCampaignSegment !== 'undefined' ? window.currentCampaignSegment : 'all';
        parentRows.forEach(function (row) {
          var campaignId = row.getAttribute('data-campaign');
          var type = row.getAttribute('data-campaign-type');
          var segmentMatch = segment === 'all' || type === segment;
          var campaignAccountRows = campaignsTable.querySelectorAll('.campaigns-child-row[data-parent="' + campaignId + '"]');
          var anyVisible = false;
          campaignAccountRows.forEach(function (ar) {
            if (ar.style.display !== 'none') anyVisible = true;
          });
          row.style.display = (segmentMatch && anyVisible) ? '' : 'none';
        });
        locationRows.forEach(function (row) {
          var expandId = row.getAttribute('data-parent');
          var accountRow = campaignsTable.querySelector('.campaigns-child-row[data-expand-id="' + expandId + '"]');
          var accountVisible = accountRow && accountRow.style.display !== 'none';
          if (!accountVisible) {
            row.style.display = 'none';
          } else {
            row.style.display = row.classList.contains('hidden') ? 'none' : '';
          }
        });
      }

      if (trigger && dropdown) {
        trigger.addEventListener('click', function (e) {
          e.stopPropagation();
          var isOpen = dropdown.classList.toggle('hidden');
          trigger.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        });
        dropdown.addEventListener('click', function (e) {
          e.stopPropagation();
        });
        document.addEventListener('click', function () {
          dropdown.classList.add('hidden');
          trigger.setAttribute('aria-expanded', 'false');
        });
      }

      checks.forEach(function (cb) {
        cb.addEventListener('change', function () {
          var isAll = this.getAttribute('data-account') === 'all';
          if (isAll && this.checked) {
            otherChecks.forEach(function (c) { c.checked = false; });
          } else if (!isAll && this.checked) {
            if (allCheck) allCheck.checked = false;
          }
          updateLabel();
          updateClearButtonState();
          filterTableBySelectedAccounts();
          if (typeof window.updateSummaryCards === 'function') window.updateSummaryCards();
          filterCampaignsTableBySelectedAccounts();
        });
      });

      if (clearBtn) {
        clearBtn.addEventListener('click', function () {
          if (this.disabled) return;
          checks.forEach(function (c) { c.checked = false; });
          if (allCheck) allCheck.checked = true;
          updateLabel();
          updateClearButtonState();
          filterTableBySelectedAccounts();
          if (typeof window.updateSummaryCards === 'function') window.updateSummaryCards();
          filterCampaignsTableBySelectedAccounts();
        });
      }

      updateClearButtonState();
      filterTableBySelectedAccounts();
      filterCampaignsTableBySelectedAccounts();
      window.filterTableBySelectedAccounts = filterTableBySelectedAccounts;
      window.filterCampaignsTableBySelectedAccounts = filterCampaignsTableBySelectedAccounts;
    })();
  </script>
  <script>
    (function () {
      var table = document.getElementById('accounts-table');
      if (!table) return;

      function accountRowKey(tr) {
        if (tr.getAttribute('data-account')) return tr.getAttribute('data-account');
        if (tr.getAttribute('data-parent') && tr.cells[1]) {
          var loc = tr.cells[1].textContent.trim().toLowerCase().replace(/\s+/g, '-');
          return tr.getAttribute('data-parent') + '-' + loc;
        }
        return null;
      }

      function getAccountMetricLinks(tr) {
        var links = [];
        for (var i = 2; i <= 6 && tr.cells[i]; i++) {
          var a = tr.cells[i].querySelector('a');
          if (a) links.push(a);
        }
        return links;
      }

      function parseNum(s) {
        if (typeof s !== 'string') return 0;
        return parseInt(s.replace(/,/g, ''), 10) || 0;
      }
      function formatNum(n) {
        return n.toLocaleString();
      }

      function buildAccountsAllMetrics() {
        var all = {};
        var rows = table.querySelectorAll('tbody tr');
        rows.forEach(function (tr) {
          var key = accountRowKey(tr);
          if (!key) return;
          var links = getAccountMetricLinks(tr);
          if (links.length !== 5) return;
          all[key] = {
            campaigns: links[0].textContent.trim(),
            sends: links[1].textContent.trim(),
            openRate: links[2].textContent.trim(),
            clickRate: links[3].textContent.trim(),
            optOut: links[4].textContent.trim()
          };
        });
        return all;
      }

      function scaleAccountMetrics(m, sendFactor, countFactor) {
        countFactor = countFactor != null ? countFactor : sendFactor;
        var campaigns = Math.round(parseNum(m.campaigns) * countFactor);
        var sends = Math.round(parseNum(m.sends) * sendFactor);
        return {
          campaigns: formatNum(campaigns),
          sends: formatNum(sends),
          openRate: m.openRate,
          clickRate: m.clickRate,
          optOut: m.optOut
        };
      }

      var accountSegmentData = null;
      function ensureAccountSegmentData() {
        if (!accountSegmentData) {
          var all = buildAccountsAllMetrics();
          accountSegmentData = {
            all: all,
            central: {},
            franchise: {}
          };
          Object.keys(all).forEach(function (key) {
            accountSegmentData.central[key] = scaleAccountMetrics(all[key], 0.38, 0.38);
            accountSegmentData.franchise[key] = scaleAccountMetrics(all[key], 0.58, 0.58);
          });
        }
        return accountSegmentData;
      }

      function updateAccountTableMetrics(segment) {
        var data = ensureAccountSegmentData();
        var metrics = data[segment] || data.all;
        var rows = table.querySelectorAll('tbody tr');
        rows.forEach(function (tr) {
          var key = accountRowKey(tr);
          if (!key || !metrics[key]) return;
          var links = getAccountMetricLinks(tr);
          if (links.length !== 5) return;
          var m = metrics[key];
          links[0].textContent = m.campaigns;
          links[1].textContent = m.sends;
          links[2].textContent = m.openRate;
          links[3].textContent = m.clickRate;
          links[4].textContent = m.optOut;
        });
      }

      window.updateAccountTableMetrics = updateAccountTableMetrics;
      updateAccountTableMetrics(typeof window.currentCampaignSegment !== 'undefined' ? window.currentCampaignSegment : 'all');
    })();
  </script>
  <script>
    (function () {
      var summaryBySegment = {
        all:      { emailsSent: 8.99, delivered: 8.63, deliveryRate: '99.4%', openRate: '65.0%', bounceRate: '0.6%', trendSent: '+5.2% vs last period', trendOpen: '-7.8% vs last period', trendBounce: '-10.7% vs last period' },
        central:  { emailsSent: 2.85, delivered: 2.72, deliveryRate: '99.4%', openRate: '62.5%', bounceRate: '0.5%', trendSent: '+2.8% vs last period', trendOpen: '-8.2% vs last period', trendBounce: '-11.5% vs last period' },
        franchise: { emailsSent: 5.2, delivered: 4.99, deliveryRate: '99.4%', openRate: '62.3%', bounceRate: '0.6%', trendSent: '+4.1% vs last period', trendOpen: '-6.0% vs last period', trendBounce: '-9.2% vs last period' }
      };
      var dateMultipliers = { '7': 0.25, '30': 1, '90': 2.8, '365': 10, 'ytd': 3, 'custom': 1 };
      function formatSummaryNum(n) {
        if (n >= 1) return (Math.round(n * 100) / 100).toFixed(2).replace(/\.?0+$/, '') + 'M';
        return Math.round(n * 1000) + 'K';
      }
      window.updateSummaryCards = function () {
        var segment = 'all';
        var activeSegment = document.querySelector('.segment-btn.bg-white, .segment-btn.font-semibold');
        if (activeSegment) segment = activeSegment.getAttribute('data-segment') || 'all';
        var dateEl = document.getElementById('date-range-label');
        var dateVal = (dateEl && dateEl.getAttribute('data-value')) || '30';
        var mult = dateMultipliers[dateVal] !== undefined ? dateMultipliers[dateVal] : 1;
        var allCheck = document.querySelector('.accounts-multiselect-check[data-account="all"]');
        var otherChecks = document.querySelectorAll('.accounts-multiselect-check:not([data-account="all"]):checked');
        var accountMult = 1;
        if (allCheck && !allCheck.checked && otherChecks.length > 0) accountMult = 0.2 * otherChecks.length;
        var data = summaryBySegment[segment] || summaryBySegment.all;
        var sent = data.emailsSent * mult * accountMult;
        var del = data.delivered * mult * accountMult;
        var elSent = document.getElementById('summary-emails-sent');
        var elTrendSent = document.getElementById('summary-emails-sent-trend');
        var elDelRate = document.getElementById('summary-delivery-rate');
        var elDelivered = document.getElementById('summary-delivered');
        var elOpen = document.getElementById('summary-open-rate');
        var elTrendOpen = document.getElementById('summary-open-rate-trend');
        var elBounce = document.getElementById('summary-bounce-rate');
        var elTrendBounce = document.getElementById('summary-bounce-rate-trend');
        if (elSent) elSent.textContent = formatSummaryNum(sent);
        if (elTrendSent) elTrendSent.textContent = data.trendSent;
        if (elDelRate) elDelRate.textContent = data.deliveryRate;
        if (elDelivered) elDelivered.textContent = formatSummaryNum(del);
        if (elOpen) elOpen.textContent = data.openRate;
        if (elTrendOpen) elTrendOpen.textContent = data.trendOpen;
        if (elBounce) elBounce.textContent = data.bounceRate;
        if (elTrendBounce) elTrendBounce.textContent = data.trendBounce;
      };
      if (document.getElementById('summary-emails-sent')) window.updateSummaryCards();
    })();
  </script>
  <script>
    (function () {
      var segmentBtns = document.querySelectorAll('.segment-btn');

      var funnelData = {
        all: {
          values: ['8.99M', '8.63M', '5.61M', '1.46M', '360K'],
          deltas: ['+5.2%', '-4.0%', '-7.8%', '-4.4%', '-10.7%'],
          deltaClasses: ['positive', 'negative', 'negative', 'negative', 'negative']
        },
        franchise: {
          values: ['5.2M', '4.99M', '3.24M', '845K', '210K'],
          deltas: ['+4.1%', '-3.2%', '-6.0%', '-3.5%', '-9.2%'],
          deltaClasses: ['positive', 'negative', 'negative', 'negative', 'negative']
        },
        central: {
          values: ['2.85M', '2.72M', '1.78M', '465K', '115K'],
          deltas: ['+2.8%', '-4.5%', '-8.2%', '-4.8%', '-11.5%'],
          deltaClasses: ['positive', 'negative', 'negative', 'negative', 'negative']
        }
      };

      function updateFunnelData(segment) {
        var data = funnelData[segment] || funnelData.all;
        for (var i = 1; i <= 5; i++) {
          var valEl = document.getElementById('funnel-value-' + i) || document.getElementById('funnel-value-' + i + '-copy');
          var deltaEl = document.getElementById('funnel-delta-' + i) || document.getElementById('funnel-delta-' + i + '-copy');
          if (valEl) valEl.textContent = data.values[i - 1];
          if (deltaEl) {
            deltaEl.textContent = data.deltas[i - 1];
            deltaEl.classList.remove('positive', 'negative');
            deltaEl.classList.add(data.deltaClasses[i - 1]);
          }
        }
      }

      segmentBtns.forEach(function (btn) {
        btn.addEventListener('click', function () {
          var seg = this.getAttribute('data-segment');
          segmentBtns.forEach(function (b) {
            b.classList.remove('bg-white', 'shadow-sm', 'text-neutral-900', 'font-semibold');
            b.classList.add('text-neutral-600', 'font-medium');
          });
          this.classList.add('bg-white', 'shadow-sm', 'text-neutral-900', 'font-semibold');
          this.classList.remove('text-neutral-600', 'font-medium');
          updateFunnelData(seg);
          if (typeof window.updateSummaryCards === 'function') window.updateSummaryCards();
          if (typeof window.filterCampaignsTableBySegment === 'function') window.filterCampaignsTableBySegment(seg);
          if (typeof window.filterCampaignsTableBySelectedAccounts === 'function') window.filterCampaignsTableBySelectedAccounts();
          var activePill = document.querySelector('.campaigns-pill.bg-main-100');
          var pillFilter = activePill ? activePill.getAttribute('data-filter') : 'all';
          if (typeof window.filterCampaignsByPill === 'function') window.filterCampaignsByPill(pillFilter);
          if (typeof window.updateCampaignTableMetrics === 'function') window.updateCampaignTableMetrics(seg);
          if (typeof window.updateAccountTableMetrics === 'function') window.updateAccountTableMetrics(seg);
        });
      });
    })();
  </script>
  <script>
    (function () {
      var accountsPills = document.querySelectorAll('.accounts-pill');
      var accountsRows = document.querySelectorAll('.accounts-row');
      var accountsFiltersRow = document.getElementById('accounts-filters-row');
      var accountsCompareBar = document.getElementById('accounts-compare-bar');
      var accountsSelectedCount = document.getElementById('accounts-selected-count');
      var accountsCompareBtn = document.getElementById('accounts-compare-btn');
      var accountsSelectAll = document.getElementById('accounts-select-all');
      var accountRowChecks = document.querySelectorAll('.account-row-check');

      function updateAccountsSelection() {
        var checked = document.querySelectorAll('.account-row-check:checked');
        var count = checked.length;
        if (accountsSelectedCount) accountsSelectedCount.textContent = count;
        if (count > 0) {
          if (accountsFiltersRow) accountsFiltersRow.classList.add('hidden');
          if (accountsCompareBar) accountsCompareBar.classList.remove('hidden');
        } else {
          if (accountsFiltersRow) accountsFiltersRow.classList.remove('hidden');
          if (accountsCompareBar) accountsCompareBar.classList.add('hidden');
        }
        if (accountsSelectAll) accountsSelectAll.checked = count === accountsRows.length && count > 0;
        accountsSelectAll.indeterminate = count > 0 && count < accountsRows.length;
      }

      accountRowChecks.forEach(function (cb) {
        cb.addEventListener('change', updateAccountsSelection);
      });
      if (accountsSelectAll) {
        accountsSelectAll.addEventListener('change', function () {
          accountsRows.forEach(function (row) {
            var check = row.querySelector('.account-row-check');
            if (check) check.checked = accountsSelectAll.checked;
          });
          updateAccountsSelection();
        });
      }

      document.querySelectorAll('.accounts-expand-btn').forEach(function (btn) {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          var account = this.getAttribute('data-expand-for');
          if (!account) return;
          var childRows = document.querySelectorAll('.accounts-child-row[data-parent="' + account + '"]');
          var isExpanded = this.classList.contains('expanded');
          childRows.forEach(function (row) {
            if (isExpanded) {
              row.classList.add('hidden');
              row.style.display = 'none';
            } else {
              row.classList.remove('hidden');
              row.style.display = '';
            }
          });
          this.classList.toggle('expanded', !isExpanded);
          this.setAttribute('aria-label', isExpanded ? 'Expand sub-accounts' : 'Collapse sub-accounts');
        });
      });

      function filterAccountsByPill(filter) {
        var table = document.getElementById('accounts-table');
        if (!table) return;
        var parentRows = table.querySelectorAll('.accounts-parent-row');
        parentRows.forEach(function (row) {
          var tier = row.getAttribute('data-tier');
          var show = filter === 'all' || tier === filter;
          row.style.display = show ? 'table-row' : 'none';
          var account = row.getAttribute('data-account');
          if (account) {
            table.querySelectorAll('.accounts-child-row[data-parent="' + account + '"]').forEach(function (child) {
              child.style.display = show ? 'table-row' : 'none';
            });
          }
        });
      }

      accountsPills.forEach(function (pill) {
        pill.addEventListener('click', function () {
          accountsPills.forEach(function (p) {
            p.classList.remove('bg-main-100', 'text-main-800');
            p.classList.add('bg-neutral-100', 'text-neutral-600');
          });
          this.classList.add('bg-main-100', 'text-main-800');
          this.classList.remove('bg-neutral-100', 'text-neutral-600');
          filterAccountsByPill(this.getAttribute('data-filter'));
          if (typeof window.filterTableBySelectedAccounts === 'function') window.filterTableBySelectedAccounts();
          if (typeof window.filterCampaignsTableBySelectedAccounts === 'function') window.filterCampaignsTableBySelectedAccounts();
        });
      });

      (function wireDrilldownLinks() {
        var metrics = ['campaigns', 'sent', 'opened', 'clicked', 'optout'];
        var rows = document.querySelectorAll('#accounts-table .accounts-row, #accounts-table .accounts-child-row');
        rows.forEach(function (row) {
          var account = row.getAttribute('data-account') || row.getAttribute('data-parent');
          if (!account) return;
          var tds = row.querySelectorAll('td');
          for (var i = 0; i < metrics.length && i + 2 < tds.length; i++) {
            var a = tds[i + 2].querySelector('a');
            if (a) a.href = 'engagement-drilldown.html?account=' + encodeURIComponent(account) + '&metric=' + metrics[i];
          }
        });
      })();

      var campaignsPills = document.querySelectorAll('.campaigns-pill');
      var campaignsRows = document.querySelectorAll('.campaigns-row');
      var campaignsTable = document.getElementById('campaigns-table');
      var campaignsCompareBar = document.getElementById('campaigns-compare-bar');
      var campaignsSelectedCount = document.getElementById('campaigns-selected-count');
      var campaignsSelectAll = document.getElementById('campaigns-select-all');
      var campaignRowChecks = document.querySelectorAll('.campaign-row-check');

      function filterCampaignsByPill(filter) {
        var segment = window.currentCampaignSegment || 'all';
        campaignsRows.forEach(function (row) {
          var tier = row.getAttribute('data-tier');
          var type = row.getAttribute('data-campaign-type');
          var segmentMatch = segment === 'all' || type === segment;
          var show = segmentMatch && (filter === 'all' || tier === filter);
          row.style.display = show ? '' : 'none';
          var campaignId = row.getAttribute('data-campaign');
          if (campaignId && campaignsTable) {
            campaignsTable.querySelectorAll('.campaigns-child-row[data-parent="' + campaignId + '"]').forEach(function (child) {
              if (!show) {
                child.style.display = 'none';
                var expandId = child.getAttribute('data-expand-id');
                if (expandId) {
                  campaignsTable.querySelectorAll('.campaigns-location-row[data-parent="' + expandId + '"]').forEach(function (loc) {
                    loc.style.display = 'none';
                  });
                }
              } else {
                child.style.display = child.classList.contains('hidden') ? 'none' : '';
              }
            });
          }
        });
      }

      function filterCampaignsTableBySegment(segment) {
        window.currentCampaignSegment = segment;
        if (!campaignsTable) return;
        var parentRows = campaignsTable.querySelectorAll('.campaigns-parent-row');
        parentRows.forEach(function (row) {
          var type = row.getAttribute('data-campaign-type');
          var show = segment === 'all' || type === segment;
          if (!show) {
            row.style.display = 'none';
            var campaignId = row.getAttribute('data-campaign');
            if (campaignId) {
              campaignsTable.querySelectorAll('.campaigns-child-row[data-parent="' + campaignId + '"]').forEach(function (child) {
                child.style.display = 'none';
                var expandId = child.getAttribute('data-expand-id');
                if (expandId) {
                  campaignsTable.querySelectorAll('.campaigns-location-row[data-parent="' + expandId + '"]').forEach(function (loc) {
                    loc.style.display = 'none';
                  });
                }
              });
            }
          }
        });
      }

      var campaignsFiltersRow = document.getElementById('campaigns-filters-row');
      function updateCampaignsSelection() {
        var checked = document.querySelectorAll('.campaign-row-check:checked');
        var count = checked.length;
        if (campaignsSelectedCount) campaignsSelectedCount.textContent = count;
        if (count > 0) {
          if (campaignsFiltersRow) campaignsFiltersRow.classList.add('hidden');
          if (campaignsCompareBar) campaignsCompareBar.classList.remove('hidden');
        } else {
          if (campaignsFiltersRow) campaignsFiltersRow.classList.remove('hidden');
          if (campaignsCompareBar) campaignsCompareBar.classList.add('hidden');
        }
        if (campaignsSelectAll && campaignsRows.length) {
          campaignsSelectAll.checked = count === campaignsRows.length && count > 0;
          campaignsSelectAll.indeterminate = count > 0 && count < campaignsRows.length;
        }
      }

      if (campaignRowChecks.length) {
        campaignRowChecks.forEach(function (cb) {
          cb.addEventListener('change', updateCampaignsSelection);
        });
      }
      if (campaignsSelectAll) {
        campaignsSelectAll.addEventListener('change', function () {
          campaignsRows.forEach(function (row) {
            var check = row.querySelector('.campaign-row-check');
            if (check) check.checked = campaignsSelectAll.checked;
          });
          updateCampaignsSelection();
        });
      }

      document.querySelectorAll('.campaigns-expand-btn').forEach(function (btn) {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          var campaignId = this.getAttribute('data-expand-for');
          if (!campaignId) return;
          var childRows = document.querySelectorAll('.campaigns-child-row[data-parent="' + campaignId + '"]');
          var isExpanded = this.classList.contains('expanded');
          childRows.forEach(function (row) {
            if (isExpanded) {
              row.classList.add('hidden');
              row.style.display = 'none';
              var expandId = row.getAttribute('data-expand-id');
              if (expandId) {
                document.querySelectorAll('.campaigns-location-row[data-parent="' + expandId + '"]').forEach(function (loc) {
                  loc.classList.add('hidden');
                  loc.style.display = 'none';
                });
              }
            } else {
              row.classList.remove('hidden');
              row.style.display = '';
            }
          });
          this.classList.toggle('expanded', !isExpanded);
          this.setAttribute('aria-label', isExpanded ? 'Expand accounts' : 'Collapse accounts');
        });
      });

      document.querySelectorAll('.campaigns-account-expand-btn').forEach(function (btn) {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          var expandId = this.getAttribute('data-expand-for');
          if (!expandId) return;
          var locationRows = document.querySelectorAll('.campaigns-location-row[data-parent="' + expandId + '"]');
          var isExpanded = this.classList.contains('expanded');
          locationRows.forEach(function (row) {
            if (isExpanded) {
              row.classList.add('hidden');
              row.style.display = 'none';
            } else {
              row.classList.remove('hidden');
              row.style.display = '';
            }
          });
          this.classList.toggle('expanded', !isExpanded);
          this.setAttribute('aria-label', isExpanded ? 'Expand locations' : 'Collapse locations');
        });
      });

      campaignsPills.forEach(function (pill) {
        pill.addEventListener('click', function () {
          campaignsPills.forEach(function (p) {
            p.classList.remove('bg-main-100', 'text-main-800');
            p.classList.add('bg-neutral-100', 'text-neutral-600');
          });
          this.classList.add('bg-main-100', 'text-main-800');
          this.classList.remove('bg-neutral-100', 'text-neutral-600');
          filterCampaignsByPill(this.getAttribute('data-filter'));
        });
      });

      window.currentCampaignSegment = 'all';
      window.filterCampaignsTableBySegment = filterCampaignsTableBySegment;
      window.filterCampaignsByPill = filterCampaignsByPill;

      (function buildAndUpdateCampaignMetrics() {
        var table = document.getElementById('campaigns-table');
        if (!table) return;
        var CENTRAL_KEYS = /^(q1-newsletter|holiday-promo)/;
        var FRANCHISE_KEYS = /^(year-in-review|december-digest|black-friday)/;

        function rowKey(tr) {
          if (tr.getAttribute('data-campaign')) return tr.getAttribute('data-campaign');
          if (tr.getAttribute('data-expand-id')) return tr.getAttribute('data-expand-id');
          if (tr.classList.contains('campaigns-location-row') && tr.cells[1]) {
            var loc = tr.cells[1].textContent.trim().toLowerCase().replace(/\s+/g, '-');
            return (tr.getAttribute('data-parent') || '') + '-' + loc;
          }
          return null;
        }

        function getMetricCells(tr) {
          var cells = [];
          for (var i = 2; i <= 5 && tr.cells[i]; i++) {
            var a = tr.cells[i].querySelector('a');
            if (a) cells.push(a);
          }
          return cells;
        }

        function parseSends(s) {
          if (typeof s !== 'string') return 0;
          return parseInt(s.replace(/,/g, ''), 10) || 0;
        }
        function formatSends(n) {
          return n.toLocaleString();
        }

        function buildAllMetrics() {
          var all = {};
          var rows = table.querySelectorAll('tbody tr');
          rows.forEach(function (tr) {
            var key = rowKey(tr);
            if (!key) return;
            var links = getMetricCells(tr);
            if (links.length !== 4) return;
            all[key] = {
              sends: links[0].textContent.trim(),
              openRate: links[1].textContent.trim(),
              clickRate: links[2].textContent.trim(),
              optOut: links[3].textContent.trim()
            };
          });
          return all;
        }

        function scaleMetrics(metrics, sendFactor, rateFactor) {
          rateFactor = rateFactor != null ? rateFactor : 1;
          var n = parseSends(metrics.sends);
          return {
            sends: formatSends(Math.round(n * sendFactor)),
            openRate: metrics.openRate,
            clickRate: metrics.clickRate,
            optOut: metrics.optOut
          };
        }

        function buildSegmentData(allData) {
          var central = {}, franchise = {};
          Object.keys(allData).forEach(function (key) {
            var m = allData[key];
            if (CENTRAL_KEYS.test(key)) {
              central[key] = scaleMetrics(m, 0.38, 1);
            } else {
              central[key] = { sends: m.sends, openRate: m.openRate, clickRate: m.clickRate, optOut: m.optOut };
            }
            if (FRANCHISE_KEYS.test(key)) {
              franchise[key] = scaleMetrics(m, 0.58, 1);
            } else {
              franchise[key] = { sends: m.sends, openRate: m.openRate, clickRate: m.clickRate, optOut: m.optOut };
            }
          });
          return { all: allData, central: central, franchise: franchise };
        }

        var segmentData = null;
        function ensureSegmentData() {
          if (!segmentData) {
            var all = buildAllMetrics();
            segmentData = buildSegmentData(all);
          }
          return segmentData;
        }

        function updateCampaignTableMetrics(segment) {
          var data = ensureSegmentData();
          var metrics = data[segment] || data.all;
          var rows = table.querySelectorAll('tbody tr');
          rows.forEach(function (tr) {
            var key = rowKey(tr);
            if (!key || !metrics[key]) return;
            var links = getMetricCells(tr);
            if (links.length !== 4) return;
            var m = metrics[key];
            links[0].textContent = m.sends;
            links[1].textContent = m.openRate;
            links[2].textContent = m.clickRate;
            links[3].textContent = m.optOut;
          });
        }

        window.updateCampaignTableMetrics = updateCampaignTableMetrics;
        updateCampaignTableMetrics(window.currentCampaignSegment || 'all');
      })();

      var compareModal = document.getElementById('compare-modal');
      var compareBackdrop = document.getElementById('compare-modal-backdrop');
      var compareClose = document.getElementById('compare-modal-close');
      var compareChips = document.getElementById('compare-chips');
      var compareEmpty = document.getElementById('compare-empty');
      var compareLoading = document.getElementById('compare-loading');
      var compareTable = document.getElementById('compare-table');
      var compareTbody = document.getElementById('compare-tbody');

      function openCompareModal(selectedAccounts) {
        compareModal.classList.remove('hidden');
        compareModal.setAttribute('aria-hidden', 'false');
        compareChips.innerHTML = '';
        selectedAccounts.forEach(function (name) {
          var chip = document.createElement('span');
          chip.className = 'inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-neutral-100 text-neutral-700 text-sm';
          chip.textContent = name;
          compareChips.appendChild(chip);
        });
        if (selectedAccounts.length < 2) {
          compareEmpty.classList.remove('hidden');
          compareLoading.classList.add('hidden');
          compareTable.classList.add('hidden');
        } else {
          compareEmpty.classList.add('hidden');
          compareLoading.classList.remove('hidden');
          compareTable.classList.add('hidden');
          setTimeout(function () {
            compareLoading.classList.add('hidden');
            compareTable.classList.remove('hidden');
            compareTbody.innerHTML = '';
            var rows = [
              { metric: 'Campaigns', a1: '320', a2: '280' },
              { metric: 'Sends', a1: '2,840,000', a2: '2,100,000' },
              { metric: 'Open rate', a1: '72.1%', a2: '68.5%' },
              { metric: 'Click rate', a1: '31.2%', a2: '28.0%' },
              { metric: 'Opt-out rate', a1: '0.4%', a2: '0.5%' }
            ];
            rows.forEach(function (r) {
              var tr = document.createElement('tr');
              tr.className = 'border-b border-neutral-100';
              tr.innerHTML = '<td class="py-3 pl-4 pr-2 sticky-col bg-white font-medium text-neutral-700">' + r.metric + '</td><td class="py-3 px-2 text-right text-sm">' + r.a1 + '</td><td class="py-3 pr-4 pl-2 text-right text-sm">' + r.a2 + '</td>';
              compareTbody.appendChild(tr);
            });
          }, 400);
        }
      }

      function closeCompareModal() {
        compareModal.classList.add('hidden');
        compareModal.setAttribute('aria-hidden', 'true');
      }

      if (accountsCompareBtn) {
        accountsCompareBtn.addEventListener('click', function () {
          var selected = [];
          document.querySelectorAll('.account-row-check:checked').forEach(function (cb) {
            var row = cb.closest('tr');
            if (row) {
              var name = row.querySelector('td:nth-child(2)');
              if (name) selected.push(name.textContent.trim());
            }
          });
          openCompareModal(selected);
        });
      }
      compareBackdrop.addEventListener('click', closeCompareModal);
      if (compareClose) compareClose.addEventListener('click', closeCompareModal);
    })();
  </script>
  <script>
    (function () {
      var feedbackTrigger = document.getElementById('feedback-trigger');
      var feedbackModal = document.getElementById('feedback-modal');
      var feedbackBackdrop = document.getElementById('feedback-modal-backdrop');
      var feedbackClose = document.getElementById('feedback-modal-close');
      var feedbackSubmit = document.getElementById('feedback-submit');
      var feedbackEmojis = document.querySelectorAll('.feedback-emoji');
      var feedbackText = document.getElementById('feedback-text');

      function openFeedbackModal() {
        if (feedbackModal) {
          feedbackModal.classList.remove('hidden');
          feedbackModal.classList.add('flex');
          feedbackModal.setAttribute('aria-hidden', 'false');
        }
      }
      function closeFeedbackModal() {
        if (feedbackModal) {
          feedbackModal.classList.add('hidden');
          feedbackModal.classList.remove('flex');
          feedbackModal.setAttribute('aria-hidden', 'true');
        }
      }

      if (feedbackTrigger) feedbackTrigger.addEventListener('click', openFeedbackModal);
      if (feedbackBackdrop) feedbackBackdrop.addEventListener('click', closeFeedbackModal);
      if (feedbackClose) feedbackClose.addEventListener('click', closeFeedbackModal);

      feedbackEmojis.forEach(function (btn) {
        btn.addEventListener('click', function () {
          feedbackEmojis.forEach(function (b) {
            b.classList.remove('border-main-500', 'bg-main-50');
            b.classList.add('border-transparent');
            b.setAttribute('aria-pressed', 'false');
          });
          this.classList.add('border-main-500', 'bg-main-50');
          this.classList.remove('border-transparent');
          this.setAttribute('aria-pressed', 'true');
        });
      });

      if (feedbackSubmit) {
        feedbackSubmit.addEventListener('click', function () {
          closeFeedbackModal();
          if (feedbackText) feedbackText.value = '';
          feedbackEmojis.forEach(function (b) {
            b.classList.remove('border-main-500', 'bg-main-50');
            b.classList.add('border-transparent');
            b.setAttribute('aria-pressed', 'false');
          });
        });
      }
    })();
  </script>
  <script>
    function toggleDropdown(dropdownId) {
      var dropdown = document.getElementById(dropdownId);
      if (!dropdown) return;
      var isHidden = dropdown.classList.contains('hidden');
      document.querySelectorAll('[id$="-dropdown"]').forEach(function (d) {
        if (d.id !== dropdownId) d.classList.add('hidden');
      });
      if (isHidden) dropdown.classList.remove('hidden');
      else dropdown.classList.add('hidden');
    }
    document.addEventListener('click', function (e) {
      if (e.target.closest('[onclick*="toggleDropdown"]') || e.target.closest('[id$="-dropdown"]')) return;
      document.querySelectorAll('[id$="-dropdown"]').forEach(function (d) { d.classList.add('hidden'); });
    });
    if (typeof lucide !== 'undefined') lucide.createIcons();

    (function() {
      var tTrigger = document.getElementById('trend-metric-trigger');
      var tDropdown = document.getElementById('trend-metric-dropdown');
      var tLabel = document.getElementById('trend-metric-label');
      if (!tTrigger || !tDropdown) return;
      tTrigger.addEventListener('click', function(e) {
        e.stopPropagation();
        tDropdown.classList.toggle('hidden');
      });
      tDropdown.querySelectorAll('.trend-metric-option').forEach(function(opt) {
        opt.addEventListener('click', function() {
          var metric = this.getAttribute('data-metric');
          tLabel.textContent = metric === 'click' ? 'Click rate' : 'Open rate';
          tDropdown.querySelectorAll('.trend-metric-option').forEach(function(o) {
            o.classList.remove('font-medium', 'text-main-600');
            o.classList.add('text-neutral-700');
          });
          this.classList.add('font-medium', 'text-main-600');
          this.classList.remove('text-neutral-700');
          var maxVal = 0;
          var bars = document.querySelectorAll('#trend-bars-container > div');
          bars.forEach(function(bar) {
            var val = parseFloat(bar.getAttribute('data-' + metric)) || 0;
            if (val > maxVal) maxVal = val;
          });
          bars.forEach(function(bar) {
            var val = parseFloat(bar.getAttribute('data-' + metric)) || 0;
            var pct = maxVal > 0 ? (val / maxVal * 100) : 0;
            var label = bar.querySelector('.trend-bar-value');
            var rect = bar.querySelector('div[class*="rounded-t-md"]');
            if (label) label.textContent = val.toFixed(1) + '%';
            if (rect) rect.style.height = pct + '%';
          });
          tDropdown.classList.add('hidden');
        });
      });
      document.addEventListener('click', function(e) {
        if (!e.target.closest('#engagement-trend-widget')) tDropdown.classList.add('hidden');
      });
    })();
  </script>
<div id="export-toast" class="export-toast hidden" role="status" aria-live="polite">Report is downloading</div>
</body>
</html>
